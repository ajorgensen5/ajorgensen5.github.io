if (self.CavalryLogger) { CavalryLogger.start_js(["SLr4I"]); }

__d("SphericalPhotoConstants",[],(function a(b,c,d,e,f,g){f.exports={QE_SPHERICAL_PHOTO_UNIVERSE:"spherical_photo",QE_WWW_UNIVERSE:"spherical_photo_www_universe",QE_WWW_COMPOSER_UNIVERSE:"spherical_photo_www_composer_universe",FEED_TRACKING_KEY:"spherical_photo_interaction"}}),null);
__d("SphericalMediaCoreActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";var h={turnOn:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").TURN_ON}},turnOff:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").TURN_OFF}},enableSpherical:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").ENABLE_SPHERICAL}},disableSpherical:function i(){return{namespace:c("SphericalMediaActionNamespaces").CORE,type:c("SphericalMediaActions").DISABLE_SPHERICAL}}};f.exports=h}),null);
__d("SphericalMediaViewActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";f.exports={updateView:function h(i){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_VIEW,data:i}},updateViewport:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_VIEWPORT,data:{yaw:i,pitch:j}}},updateFOV:function h(i){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_FOV,data:{fov:i}}},updateYaw:function h(i){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_YAW,data:{yaw:i}}},updateViewportAndFOV:function h(i,j,k){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV,data:{yaw:i,pitch:j,fov:k}}},startAnimating:function h(){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").START_ANIMATING}},stopAnimating:function h(){return{namespace:c("SphericalMediaActionNamespaces").VIEW,type:c("SphericalMediaActions").STOP_ANIMATING}}}}),null);
__d("SphericalMediaController.react",["cx","Event","React","SphericalPhotoPartialLimits","SphericalViewportControl","SubscriptionsHandler","debounce","getElementRect","performanceNow","throttle","SphericalPhotoConfig","SphericalMediaConstants"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalPhotoPartialLimits").makePartialLimits,l=c("SphericalMediaConstants").GYRO_SLIP_FACTOR,m=c("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,n=c("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_MS,o=c("SphericalMediaConstants").RB_FRICTION,p=c("SphericalMediaConstants").RB_SPRING_FACTOR,q=c("SphericalMediaConstants").RB_MAX_SPRING_DEGREE,r=c("SphericalMediaConstants").RB_MAX_STRETCH_X_DEGREE,s=c("SphericalMediaConstants").RB_MAX_STRETCH_Y_DEGREE,t=c("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE;i=babelHelpers.inherits(u,c("React").Component);j=i&&i.prototype;function u(v){__p&&__p();j.constructor.call(this,v);this.$SphericalMediaController3=0;this.$SphericalMediaController5=false;this.onViewChange=function(){var w=this.__sphericalViewportControl;if(w&&!w.isUpdating()){var x=this.__getViewData(),y=w.getOrientation(),z=w.getVerticalFieldOfView(),A=x.fov!==z||x.pitch!==y.y||x.yaw!==y.x;if(A){w.updateViewport(x.yaw,x.pitch,x.fov);this.$SphericalMediaController4=babelHelpers["extends"]({},x)}}}.bind(this);this.$SphericalMediaController6=function(){if(!this.__viewport)return;var w=c("getElementRect")(this.__viewport);if(w.left!==0||w.right!==0||w.top!==0||w.bottom!==0||w.height!==0||w.width!==0)this.$SphericalMediaController1={x:w.left,y:w.top}}.bind(this);this.$SphericalMediaController2=new(c("SubscriptionsHandler"))();this.$SphericalMediaController2.addSubscriptions(c("Event").listen(window,"resize",c("debounce")(this.$SphericalMediaController6)))}u.prototype.UNSAFE_componentWillReceiveProps=function(v){if(v.isActive!==this.props.isActive&&!v.isActive)this.$SphericalMediaController7();if(v.isActive)if(v.width!==this.props.width||v.height!==this.props.height)this.$SphericalMediaController8(v.width,v.height)};u.prototype.componentDidMount=function(){this.props.isActive&&this.$SphericalMediaController9()};u.prototype.shouldComponentUpdate=function(v){var w=v.isActive&&!this.__sphericalViewportControl||v.width!==this.props.width||v.height!==this.props.height;return w};u.prototype.componentDidUpdate=function(){if(this.props.isActive&&!this.__sphericalViewportControl)this.$SphericalMediaController9();this.$SphericalMediaController6()};u.prototype.componentWillUnmount=function(){this.$SphericalMediaController7()};u.prototype.$SphericalMediaController9=function(){__p&&__p();var v=void 0;if(!this.__viewport)return;v=this.__viewport;var w=this.__getSphericalConfig(this.props),x=new(c("SphericalViewportControl"))(v,w,this.$SphericalMediaController10(),this.props.showNewPhotoRenderer);this.$SphericalMediaController4={fov:w.fieldOfView,pitch:w.initialPitch,yaw:w.initialHeading};this.$SphericalMediaController6();x.addListener("updateViewportBegin",this.__onUpdateViewportBegin);x.addListener("updateViewportMoveStart",this.__onUpdateViewportMoveStart);x.addListener("DOM/click",this.__onDOMClick);x.addListener("updateViewportEnd",function(y,z){this.__onUpdateViewportEnd();this.$SphericalMediaController11()}.bind(this));x.addListener("initialViewportChange",this.__onInitialViewportChange);x.addListener("viewportChange",this.__onViewportChange);x.addListener("zoomStart",this.__onZoomStart);x.addListener("mouseEnter",this.__onMouseEnter);x.addListener("mouseMove",c("throttle")(this.__onMouseMove));if(this.props.showNewPhotoRenderer&&this.props.initialFov>179)x.setInitialOrientation();this.__sphericalViewportControl=x;this.$SphericalMediaController8(this.props.width,this.props.height)};u.prototype.$SphericalMediaController7=function(){this.$SphericalMediaController2.release();this.__sphericalViewportControl&&this.__sphericalViewportControl.destroy();this.__sphericalViewportControl=null;this.$SphericalMediaController5=true};u.prototype.$SphericalMediaController11=function(){__p&&__p();var v=c("performanceNow")();if(Math.abs(v-this.$SphericalMediaController3)<n)return;var w=this.$SphericalMediaController4;if(!w)return;var x=this.__getViewData(),y=x.yaw-w.yaw,z=x.pitch-w.pitch,A=Math.sqrt(Math.pow(y,2)+Math.pow(z,2));if(m<A){this.__onSignificantMove(x);this.$SphericalMediaController3=v;this.$SphericalMediaController4=babelHelpers["extends"]({},x)}};u.prototype.$SphericalMediaController8=function(v,w,x){__p&&__p();var y=this.__sphericalViewportControl;if(y){y.updateViewportClientSize({width:v,height:w});if(this.props.maxTileLevel>0){var z=Math.pow(2,this.props.maxTileLevel),A=t*z/90,B=w/A/3;y.updateMinVFOV(B)}if(c("SphericalPhotoConfig").enable_stereograph_renderer){y.updateMaxVFOV(160);y.updateMaxHFOV(200)}var C=this.__getViewData();y.setFieldOfView(C.fov);var D=y.getVerticalFieldOfView();if(D!==C.fov)this.__updateFOV(D)}};u.prototype.$SphericalMediaController10=function(){return{disableAutoClientSizeUpdate:true,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:q,maxStretchXDegrees:r,maxStretchYDegrees:s,minVFOV:this.props.maxTileLevel,rubberBandConstant:o,slipFactor:l,springFactor:p,enableZoomWithShiftKey:false,enablePanningWithRightMouse:false}};u.prototype.__getSphericalConfig=function(v){var w=this.__getPartialLimits(v),x=v.initialYaw,y=v.initialPitch,z=v.initialFov;if(this.$SphericalMediaController5){var A=this.__getViewData();z=A.fov;y=A.pitch;x=A.yaw}return{initialHeading:x,initialPitch:y,fieldOfView:z,keyboardVelocityFactor:v.keyboardVelocityFactor,panningVelocityFactor:v.panningVelocityFactor,enableZoom:v.enableZoom,partialLimits:w||undefined}};u.prototype.__getPartialLimits=function(v){if(v.partialLimits.partialLeftDegrees||v.partialLimits.partialRightDegrees||v.partialLimits.partialTopDegrees||v.partialLimits.partialBottomDegrees)return k({partialLeftDegrees:v.partialLimits.partialLeftDegrees,partialRightDegrees:v.partialLimits.partialRightDegrees,partialTopDegrees:v.partialLimits.partialTopDegrees,partialBottomDegrees:v.partialLimits.partialBottomDegrees});return null};u.prototype.__getViewportMousePosition=function(v){if(!this.$SphericalMediaController1){this.$SphericalMediaController6();if(!this.$SphericalMediaController1)return null}return{x:(v.clientX||v.changedTouches[0].clientX)-this.$SphericalMediaController1.x,y:(v.clientY||v.changedTouches[0].clientY)-this.$SphericalMediaController1.y}};u.prototype.__changeCursorStyle=function(v){if(!this.__viewport)return;this.__viewport.style.cursor=v};u.prototype.render=function(){return c("React").createElement("div",{ref:function(v){return this.__viewport=v}.bind(this),className:"_5nxw _25i_"+(!this.props.isActive?" hidden_elem":""),tabIndex:0,"aria-label":this.props.caption})};f.exports=u}),null);
__d("SphericalMediaRenderer.react",["cx","DOM","BackgroundImage.react","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j;i=babelHelpers.inherits(k,c("React").Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);this.$SphericalMediaRenderer2=false;this.$SphericalMediaRenderer3=false;if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var m in this.constructor.__subClassMethods)if(typeof this[m]!=="function")throw new Error('Must implement "'+m+'"')}k.prototype.UNSAFE_componentWillReceiveProps=function(l){if(!l.isActive&&this.sphericalRenderer){this.__destroy();return}};k.prototype.shouldComponentUpdate=function(l){return this.shouldRender};k.prototype.componentDidMount=function(){this.$SphericalMediaRenderer4()};k.prototype.componentWillUnmount=function(){this.__destroy()};k.prototype.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null};k.prototype.$SphericalMediaRenderer4=function(){__p&&__p();if(this.$SphericalMediaRenderer2||!this.__isReadyToSetup()||!this.$SphericalMediaRenderer1||this.$SphericalMediaRenderer3)return;this.$SphericalMediaRenderer3=true;var l=this.__getCanvas();this.__getRenderer(l).done(function(m){__p&&__p();m.updateViewportDimensions(this.props.width,this.props.height);m.addListener("renderingError",function(n,o){return this.__onWebGlRenderFailed(n,o)}.bind(this));m.addListener("renderingContextLost",function(){return this.__onWebGlContextLost()}.bind(this));c("DOM").setContent(this.$SphericalMediaRenderer1,l);this.sphericalRenderer=m;m.renderErrorCheck();this.$SphericalMediaRenderer3=false;this.__onSetupDone(m)}.bind(this),function(m){this.$SphericalMediaRenderer2=true;this.$SphericalMediaRenderer3=false;this.__onWebGlInitFailed(m);return}.bind(this))};k.prototype.draw=function(l){__p&&__p();if(!this.sphericalRenderer)return;var m=this.sphericalRenderer;if(!m)return;try{m.render(l);this.__afterDraw(m)}catch(n){this.__onWebGlRenderFailed(n,l);return}};k.prototype.componentDidUpdate=function(){if(!this.props.isActive)return;var l=this.sphericalRenderer;if(!l)this.$SphericalMediaRenderer4();else{l.updateViewportDimensions(this.props.width,this.props.height);this.draw(this.__getViewData())}};k.prototype.render=function(){var l=void 0;if(this.props.thumbnail)l=c("React").createElement(c("BackgroundImage.react"),{className:(!this.__showLoadingThumbnail()||this.props.isActive&&this.sphericalRenderer?"hidden_elem":"")+" _2vjf",src:this.props.thumbnail,width:this.props.width,height:this.props.height,backgroundSize:"cover"});return c("React").createElement("div",{className:"_4trl"},c("React").createElement("div",{className:(!this.props.isActive||!this.sphericalRenderer?"hidden_elem":"")+" _4trl",ref:function(m){return this.$SphericalMediaRenderer1=m}.bind(this)}),l)};f.exports=k}),null);
__d("SphericalMediaBaseStore",["ReduxThunk","redux"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("redux").compose,i=c("redux").applyMiddleware,j=c("redux").createStore,k=c("redux").combineReducers;function l(){var m=arguments.length<=0||arguments[0]===undefined?[]:arguments[0],n=i.apply(undefined,[c("ReduxThunk")].concat(m)),o=k(this.getReducers());this.$SphericalMediaBaseStore1=h(n)(j)(o)}l.prototype.getStore=function(){return this.$SphericalMediaBaseStore1};l.prototype.getReducers=function(){throw new Error("Implement _getReducers")};f.exports=l}),null);
__d("SphericalMediaViewReducer",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={fov:65,pitch:0,yaw:0,isAnimating:false,centeredYaw:0},i=function i(){__p&&__p();var j=arguments.length<=0||arguments[0]===undefined?h:arguments[0],k=arguments[1];if(k.namespace!==c("SphericalMediaActionNamespaces").VIEW)return j;var l={};switch(k.type){case c("SphericalMediaActions").UPDATE_VIEW:l=k.data;l.centeredYaw=k.data.yaw;break;case c("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV:var m=k.data,n=m.pitch,o=m.fov,p=m.yaw;if(!isNaN(n+o+p)){l.fov=o;l.pitch=n;l.yaw=p;l.centeredYaw=p}break;case c("SphericalMediaActions").UPDATE_VIEWPORT:l.pitch=k.data.pitch;l.yaw=k.data.yaw;l.centeredYaw=k.data.yaw;break;case c("SphericalMediaActions").UPDATE_FOV:l.fov=k.data.fov;break;case c("SphericalMediaActions").UPDATE_YAW:l.yaw=k.data.yaw;break;case c("SphericalMediaActions").START_ANIMATING:l.isAnimating=true;break;case c("SphericalMediaActions").STOP_ANIMATING:l.isAnimating=false;break}return babelHelpers["extends"]({},j,l)};f.exports=i}),null);
__d("SphericalMediaViewStore",["SphericalMediaBaseStore","SphericalMediaViewReducer"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("SphericalMediaBaseStore"));i=h&&h.prototype;j.prototype.getReducers=function(){return{view:c("SphericalMediaViewReducer")}};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("SphericalMediaBaseRecord",["PhotoProjection","immutable","SphericalMediaViewStore","SphericalPhotoPartialLimits"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("PhotoProjection").CUBESTRIP,k=c("SphericalPhotoPartialLimits").makePartialLimits,l=c("immutable").Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:false,enablePartialLimit:false,enableRubberBanding:false,enableZoom:false,showFallbackUI:false,useFallbackUI:false,useLargeHeadingIndicator:false,useLargeVolumeIcon:false,partialLimits:k({partialLeftDegrees:undefined,partialRightDegrees:undefined,partialTopDegrees:undefined,partialBottomDegrees:undefined}),isPanning:false,hasInteracted:false,visibility:true,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:false,isRendererSetup:false,className:"",projectionType:j,expansionCoef:undefined,tiledSphericalConfig:{useTiledRenderer:false,initialTileUris:[],viewportTileUris:[],maxTileLevel:0},canvasNamespace:"SphericalMedia",caption:"",type:"photo",src:"",flatImage:"",originalImageURI:"",thumbnail:"",fbid:"",loaded:false,enableSpherical:true,isFetchingData:false,photoSphereMetadata:{},exif:{},useLocalSphericalImage:false,fallback:null,fallbackCTAElement:null,enableTagging:false,tags:[],tagUnderMouse:null,tagClicked:null,isTagging:false,tagger:null,taggingMode:false,targetedTag:null,sourceProjectionType:null,surface:"",sessionID:"",viewStore:new(c("SphericalMediaViewStore"))().getStore(),ctrElement:null,ambientAudio:[],feedRootElement:null});h=babelHelpers.inherits(m,l);i=h&&h.prototype;function m(){h.apply(this,arguments)}f.exports=m}),null);
__d("SphericalMediaBaseReducer",["SphericalMediaActionNamespaces","SphericalMediaActions","SphericalMediaBaseRecord","SphericalMediaViewStore","PhotoRendererProjection","SphericalPhotoPartialLimits"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalPhotoPartialLimits").makePartialLimits,i=function i(){return new(c("SphericalMediaBaseRecord"))({viewStore:new(c("SphericalMediaViewStore"))().getStore()})},j=function j(){__p&&__p();var k=arguments.length<=0||arguments[0]===undefined?i():arguments[0],l=arguments[1];if(l.namespace!==c("SphericalMediaActionNamespaces").CORE&&l.namespace!==c("SphericalMediaActionNamespaces").BASE)return k;switch(l.type){case c("SphericalMediaActions").UPDATE_BASE:var m=l.data;return k.withMutations(function(A){__p&&__p();A.merge(m);if(m.photoSphereMetadata)A.set("photoSphereMetadata",m.photoSphereMetadata);if(m.tiledSphericalConfig)A.set("tiledSphericalConfig",m.tiledSphericalConfig);if(m.tags)A.set("tags",m.tags);if(m.tagUnderMouse)A.set("tagUnderMouse",m.tagUnderMouse);if(m.tagClicked)A.set("tagClicked",m.tagClicked);if(m.tagger)A.set("tagger",m.tagger);if(m.exif)A.set("exif",m.exif);if(m.fallback)A.set("fallback",m.fallback);if(m.ambientAudio)A.set("ambientAudio",m.ambientAudio)});case c("SphericalMediaActions").DRAG_START:return k.withMutations(function(A){A.set("isPanning",true);A.set("hasInteracted",true)});case c("SphericalMediaActions").VISIBILITY_CHANGED:return k.set("visibility",l.data);case c("SphericalMediaActions").UPDATE_INITIAL_FOV:return k.set("initialFov",l.data.initialFov);case c("SphericalMediaActions").UPDATE_INITIAL_VIEWPORT:var n=l.data;return k.withMutations(function(A){A.set("initialYaw",n.initialYaw);A.set("initialPitch",n.initialPitch)});case c("SphericalMediaActions").UPDATE_DIMENSION:var o=l.data;return k.withMutations(function(A){A.set("height",o.height);A.set("width",o.width);A.set("aspectRatio",o.width/o.height)});case c("SphericalMediaActions").SETUP_RENDERER:var p=l.data.renderer;return k.withMutations(function(A){A.set("isRendererSetup",true);A.set("renderer",p)});case c("SphericalMediaActions").TURN_ON:return k.set("isRendererActive",true);case c("SphericalMediaActions").TURN_OFF:return k.withMutations(function(A){A.set("isRendererActive",false);A.set("isRendererSetup",false);A.set("renderer",null)});case c("SphericalMediaActions").REPLACE_BASE_STATE:return l.data;case c("SphericalMediaActions").SOURCE_ONLOAD:return k.set("loaded",true);case c("SphericalMediaActions").DISABLE_SPHERICAL:return k.set("enableSpherical",false);case c("SphericalMediaActions").ENABLE_SPHERICAL:return k.set("enableSpherical",true);case c("SphericalMediaActions").REQUEST_PHOTO:return k.withMutations(function(A){A.set("loaded",false);A.set("isFetchingData",true)});case c("SphericalMediaActions").RECEIVE_PHOTO:var q=l.data,r=q.partialLimits,s=q.photoSphereMetadata||{};return k.withMutations(function(A){__p&&__p();A.set("fbid",q.photoID);A.set("flatImage",q.flatImage);A.set("initialFov",q.initialFov);A.set("initialPitch",q.initialPitch);A.set("initialYaw",q.initialYaw);A.set("isFetchingData",false);A.set("originalImageURI",q.originalImageURI);A.set("partialLimits",h({partialLeftDegrees:r.partialLeftDegrees,partialRightDegrees:r.partialRightDegrees,partialTopDegrees:r.partialTopDegrees,partialBottomDegrees:r.partialBottomDegrees}));A.set("sourceProjectionType",s.ProjectionType);A.set("src",q.src);A.set("thumbnail",q.thumbnail);A.set("photoSphereMetadata",s);if(s&&(s.RendererProjectionType===c("PhotoRendererProjection").CYLINDRICAL||s.RendererProjectionType===c("PhotoRendererProjection").EQUIRECTANGULAR))A.set("enableSpherical",false)});case c("SphericalMediaActions").UPDATE_CTR_ELEM:return k.set("ctrElement",l.data.element);case c("SphericalMediaActions").ENABLE_TAGGING:return k.set("enableTagging",true);case c("SphericalMediaActions").DISABLE_TAGGING:return k.set("enableTagging",false);case c("SphericalMediaActions").UPDATE_SPATIAL_TAGS_FROM_COMPOSER:case c("SphericalMediaActions").UPDATE_SPATIAL_TAGS:var t=l.data;return k.withMutations(function(A){A.set("tags",t)});case c("SphericalMediaActions").UPDATE_TAG_UNDER_MOUSE:var u=l.data;return k.withMutations(function(A){A.set("tagUnderMouse",u)});case c("SphericalMediaActions").CANVAS_RESIZE_SUCCESS:var v=l.data;return k.withMutations(function(A){A.set("src",v)});case c("SphericalMediaActions").TAGGING_START:return k.set("isTagging",true);case c("SphericalMediaActions").TAGGING_STOP:return k.set("isTagging",false);case c("SphericalMediaActions").UPDATE_TAG_CLICKED:var w=l.data;return k.withMutations(function(A){A.set("tagClicked",w)});case c("SphericalMediaActions").UPDATE_TAGGER:var x=l.data;return k.withMutations(function(A){A.set("tagger",x)});case c("SphericalMediaActions").ENTER_TAGGING_MODE:return k.set("taggingMode",true);case c("SphericalMediaActions").EXIT_TAGGING_MODE:return k.set("taggingMode",false);case c("SphericalMediaActions").UPDATE_TARGETED_TAG:var y=l.data;return k.withMutations(function(A){A.set("targetedTag",y)});case c("SphericalMediaActions").SHOW_FALLBACK:return k.set("showFallbackUI",true);case c("SphericalMediaActions").USE_FALLBACK:return k.withMutations(function(A){A.set("useFallbackUI",true);A.set("enableRubberBanding",false)});case c("SphericalMediaActions").UPDATE_FEED_ROOT_ELEMENT:return k.set("feedRootElement",l.data);case c("SphericalMediaActions").UPDATE_PARTIAL_LIMITS:var z=l.data;return k.withMutations(function(A){A.set("partialLimits",h({partialLeftDegrees:z.partialLeftDegrees,partialRightDegrees:z.partialRightDegrees,partialTopDegrees:z.partialTopDegrees,partialBottomDegrees:z.partialBottomDegrees}))})}return k};f.exports=j}),null);
__d("SphericalPhotoActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";f.exports={rendererStats:function h(i){return{namespace:c("SphericalMediaActionNamespaces").PHOTO,type:c("SphericalMediaActions").PHOTO_RENDERER_STATS,data:i}}}}),null);
__d("SphericalMediaTaggingUtils",["SphericalPhotoProjectionUtils","SphericalProjectionUtils","degToRad","gl-matrix","radToDeg"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("gl-matrix").vec3,i={getSpatialTagArea:function j(k,l,m){var n=m.h/l.fov,o={w:Math.abs(k.width_degree)*n,h:Math.abs(k.height_degree)*n},p=c("SphericalProjectionUtils").convert3dTo2dScaledUnique(k.center.yaw,k.center.pitch,l.yaw,l.pitch,l.fov,m.w,m.h);return{topLeft:{x:p.x-o.w/2,y:p.y-o.h/2},bottomRight:{x:p.x+o.w/2,y:p.y+o.h/2}}},getSpatialTagAreaInNewPhotoRenderer:function j(k,l,m,n){var o=m.h/l.fov,p={w:Math.abs(k.width_degree)*o,h:Math.abs(k.height_degree)*o},q=c("SphericalPhotoProjectionUtils").convert3dTo2d(k.center.yaw,k.center.pitch,l,m.w,m.h,n);return{topLeft:{x:q.x-p.w/2,y:q.y-p.h/2},bottomRight:{x:q.x+p.w/2,y:q.y+p.h/2}}},isPointInTagArea:function j(k,l,m,n){var o=i.getSpatialTagArea(l,m,n);return!(o.topLeft.x>k.x||o.bottomRight.x<k.x||o.topLeft.y>k.y||o.bottomRight.y<k.y)},isPointInTagAreaInNewPhotoRenderer:function j(k,l,m,n,o){var p=i.getSpatialTagAreaInNewPhotoRenderer(l,m,n,o);return!(p.topLeft.x>k.x||p.bottomRight.x<k.x||p.topLeft.y>k.y||p.bottomRight.y<k.y)},pointsToRectSize:function j(k){var l=k.topLeft,m=k.bottomRight;return{w:Math.abs(m.x-l.x),h:Math.abs(m.y-l.y)}},rectSizeToPoints:function j(k,l){return{topLeft:k,bottomRight:{x:k.x+Math.abs(l.w),y:k.y+Math.abs(l.h)}}},rectSizeToDegreeSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return{widthDegree:k/o*360,heightDegree:l/n*180}},degreeSizeToRectSize:function j(k,l,m){var n=Number(m.FullPanoHeightPixels),o=Number(m.FullPanoWidthPixels);return{w:k/360*o,h:l/180*n}},yawPitchToPhotoXY:function j(k,l,m){var n=Number(m.PosePitchDegrees),o=Number(m.PoseRollDegrees),p=Number(m.CroppedAreaImageHeightPixels),q=Number(m.CroppedAreaImageWidthPixels),r=Number(m.CroppedAreaLeftPixels),s=Number(m.CroppedAreaTopPixels),t=Number(m.FullPanoHeightPixels),u=Number(m.FullPanoWidthPixels),v=i.yawPitchToVec3(k,l),w=[v.x,v.y,v.z];if(n!==0)h.rotateX(w,w,[0,0,0],c("degToRad")(-n));if(o!==0)h.rotateZ(w,w,[0,0,0],c("degToRad")(o));var x=i.vec3ToPhotoXY(w[0],w[1],w[2]),y=x.x*u-r,z=x.y*t-s,A=y/q,B=z/p;return{x:A,y:B}},photoXYToYawPitch:function j(k,l){var m=Number(l.PosePitchDegrees),n=Number(l.PoseRollDegrees),o=Number(l.CroppedAreaImageHeightPixels),p=Number(l.CroppedAreaImageWidthPixels),q=Number(l.CroppedAreaLeftPixels),r=Number(l.CroppedAreaTopPixels),s=Number(l.FullPanoHeightPixels),t=Number(l.FullPanoWidthPixels),u=k.x*p,v=k.y*o,w=(u+q)/t,x=(v+r)/s,y=i.photoXYToVec3(w,x),z=[y.x,y.y,y.z];if(n!==0)h.rotateZ(z,z,[0,0,0],c("degToRad")(-n));if(m!==0)h.rotateX(z,z,[0,0,0],c("degToRad")(m));return i.vec3ToYawPitch.apply(i,z)},yawPitchToVec3:function j(k,l){var m=c("degToRad")(k),n=c("degToRad")(90-l),o=Math.abs(k)>90?1:-1,p=Math.tan(m)*-o;if(!isFinite(p))return{x:1,y:0,z:0};var q=Math.sqrt(p*p+o*o)/Math.tan(n);if(!isFinite(q))return{x:0,y:1,z:0};return{x:p,y:q,z:o}},vec3ToYawPitch:function j(k,l,m){var n=Math.atan2(Math.sqrt(k*k+m*m),l),o=Math.atan2(k,-m);return{yaw:c("radToDeg")(o),pitch:90-c("radToDeg")(n)}},vec3ToPhotoXY:function j(k,l,m){__p&&__p();var n=Math.abs(Math.atan2(l,Math.sqrt(k*k+m*m)));if(l>0&&n<0)n*=-1;if(l<0&&n>0)n*=-1;n=(-n+Math.PI/2)/Math.PI;var o=-1*Math.atan2(k,m);if(o<0)o+=2*Math.PI;o/=2*Math.PI;return{x:o,y:n}},photoXYToVec3:function j(k,l){var m=(l-.5)*Math.PI,n=Math.sin(m),o=Math.cos(m),p=(k-.75)*2*Math.PI,q=Math.sin(p),r=Math.cos(p);k=r*o;l=-n;var s=q*o;return{x:k,y:l,z:s}},normalizeComposerXYToPhotoXY:function j(k){return k/100},normalizePhotoXYToComposerXY:function j(k){return k*100},coordinatesAreClose:function j(k,l){var m=arguments.length<=2||arguments[2]===undefined?.001:arguments[2],n=Math.abs(k.x-l.x),o=Math.abs(k.y-l.y);return!(n>m||o>m)},compareTags:function j(k,l){return!(k.center.pitch!==l.center.pitch||k.center.vec3[0]!==l.center.vec3[0]||k.center.vec3[1]!==l.center.vec3[1]||k.center.vec3[2]!==l.center.vec3[2]||k.center.yaw!==l.center.yaw||k.centerXY.x!==l.centerXY.x||k.centerXY.y!==l.centerXY.y||k.height_degree!==l.height_degree||k.width_degree!==l.width_degree)},getSpatialTagFromFBID:function j(k,l){for(var m=0;m<l.length;m++)if(l[m].fbid==k)return l[m];return null}};f.exports=i}),null);
__d("SphericalPhotoController.redux",["DOM","ReactRedux","SphericalMediaBaseActions","SphericalMediaConstants","SphericalMediaController.react","SphericalMediaTaggingUtils","SphericalMediaViewActions","SphericalPhotoConfig","SphericalPhotoPartialLimits","SphericalPhotoProjectionUtils","SphericalProjectionUtils","UserAgent","goURI","normalizeDeltaYaw"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("ReactRedux").connect,k=c("SphericalMediaBaseActions").dragStart,l=c("SphericalMediaBaseActions").gyroStart,m=c("SphericalMediaBaseActions").mouseEnter,n=c("SphericalMediaBaseActions").redirectFromClickedTag,o=c("SphericalMediaBaseActions").significantMove,p=c("SphericalMediaBaseActions").taggingStart,q=c("SphericalMediaBaseActions").taggingStop,r=c("SphericalMediaBaseActions").updateBase,s=c("SphericalMediaBaseActions").updateInitialViewport,t=c("SphericalMediaBaseActions").updateTagClicked,u=c("SphericalMediaBaseActions").updateTagUnderMouse,v=c("SphericalMediaBaseActions").viewportClicked,w=c("SphericalMediaBaseActions").updateCtrElem,x=c("SphericalMediaBaseActions").zoomStart,y=c("SphericalMediaConstants").UNTAGGED_FACEBOX,z=c("SphericalMediaViewActions").stopAnimating,A=c("SphericalMediaViewActions").updateViewportAndFOV,B=c("SphericalMediaViewActions").updateFOV,C=c("SphericalPhotoPartialLimits").makePartialLimits,D=c("SphericalProjectionUtils").convert3dTo2dScaledUnique;h=babelHelpers.inherits(E,c("SphericalMediaController.react"));i=h&&h.prototype;function E(G){__p&&__p();i.constructor.call(this,G);this.$SphericalPhotoController5=function(){this.onViewChange()}.bind(this);this.__onUpdateViewportBegin=function(){this.props.viewStore.dispatch(z())}.bind(this);this.__onUpdateViewportMoveStart=function(H){var I=this.props.dispatch;if(H)I(l());else I(k())}.bind(this);this.__onDOMClick=function(H){if(this.props.enableTagging){this.props.taggingMode?this.$SphericalPhotoController8(H):this.$SphericalPhotoController10(H);var I=this.$SphericalPhotoController7(H);this.props.dispatch(t(I))}this.props.dispatch(v())}.bind(this);this.__onViewportChange=function(H,I,J){if(this.props.enableTagging){var K=this.props,L=K.dispatch,M=K.isTagging,N=K.tagger;if(M&&N){N.hideTagger();L(q())}L(t(null))}this.props.viewStore.dispatch(A(H,I,J))}.bind(this);this.__onInitialViewportChange=function(H,I){this.props.dispatch(s(H,I))}.bind(this);this.__onZoomStart=function(){this.props.dispatch(x())}.bind(this);this.__onMouseEnter=function(){this.props.dispatch(m())}.bind(this);this.__onMouseMove=function(H){if(this.props.enableTagging){var I=this.$SphericalPhotoController7(H);if(I)if(I.type!==y)this.__changeCursorStyle("pointer");else this.__changeCursorStyle("crosshair");else this.__changeCursorStyle(this.$SphericalPhotoController6());this.props.dispatch(u(this.$SphericalPhotoController7(H)))}}.bind(this)}E.prototype.UNSAFE_componentWillReceiveProps=function(G){i.UNSAFE_componentWillReceiveProps.call(this,G);if(G.isTagging)this.__sphericalViewportControl&&this.__sphericalViewportControl.disableKeyboard();else this.__sphericalViewportControl&&this.__sphericalViewportControl.enableKeyboard();if(G.enableTagging&&this.props.taggingMode!==G.taggingMode)this.$SphericalPhotoController3(G);if(!G.partialLimits.equals(this.props.partialLimits))this.$SphericalPhotoController4(G)};E.prototype.shouldComponentUpdate=function(G){var H=i.shouldComponentUpdate.call(this,G)||this.props.tagger!==G.tagger&&this.props.enableTagging;return H};E.prototype.componentDidMount=function(){i.componentDidMount.call(this);this.props.viewStore.subscribe(this.$SphericalPhotoController5);this.props.dispatch(w(this.__viewport));this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};E.prototype.componentDidUpdate=function(){i.componentDidUpdate.call(this);this.props.dispatch(w(this.__viewport));this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};E.prototype.componentWillUnmount=function(){i.componentWillUnmount.call(this);this.props.dispatch(w(null))};E.prototype.$SphericalPhotoController3=function(G){__p&&__p();var H=G.tagger,I=this.__sphericalViewportControl;if(H&&I){if(this.$SphericalPhotoController1){I.removeLayer(this.$SphericalPhotoController1);this.$SphericalPhotoController1=null}if(this.$SphericalPhotoController2){I.removeLayer(this.$SphericalPhotoController2);this.$SphericalPhotoController2=null}try{var J=c("DOM").find(H.tagger,"div.faceBox");this.$SphericalPhotoController1=I.addNewLayer(J);if(G.taggingMode)this.$SphericalPhotoController2=I.addNewLayer(H.viewer.stageActions)}catch(K){}}};E.prototype.$SphericalPhotoController4=function(G){if(this.__sphericalViewportControl){this.__sphericalViewportControl.reconfigure(this.__getSphericalConfig(G));G.viewStore.dispatch(A(G.initialYaw,G.initialPitch,G.initialFov))}};E.prototype.$SphericalPhotoController6=function(){var G="grab";if(c("UserAgent").isEngine("WebKit"))G="-webkit-"+G;else if(c("UserAgent").isEngine("Gecko"))G="-moz-"+G;return G};E.prototype.$SphericalPhotoController7=function(G){var H=this.__getViewportMousePosition(G);if(!H)return null;var I=this.props,J=I.partialLimits,K=I.showNewPhotoRenderer,L=I.tags,M=this.props.viewStore.getState(),N=M.view,O=null;if(L)L.forEach(function(P){if(K&&c("SphericalMediaTaggingUtils").isPointInTagAreaInNewPhotoRenderer(H,P,N,{w:this.props.width,h:this.props.height},C({partialLeftDegrees:J.partialLeftDegrees,partialRightDegrees:J.partialRightDegrees,partialTopDegrees:J.partialTopDegrees,partialBottomDegrees:J.partialBottomDegrees}))||c("SphericalMediaTaggingUtils").isPointInTagArea(H,P,N,{w:this.props.width,h:this.props.height}))O=P}.bind(this));return O};E.prototype.$SphericalPhotoController8=function(G){__p&&__p();if(!this.props.tagger)return;var H=this.$SphericalPhotoController7(G),I=this.__getViewData(),J=this.props,K=J.height,L=J.partialLimits,M=J.photoSphereMetadata,N=J.showNewPhotoRenderer,O=J.width,P=void 0,Q=void 0,R=void 0,S=void 0,T=void 0;if(H){if(H.type!==y){this.props.dispatch(n());H.url&&c("goURI")(H.url,true);return}if(H.type===y){var U=H.center,V=U.yaw,W=U.pitch;if(N){P=c("SphericalPhotoProjectionUtils").convert3dTo2d(V,W,I,O,K,L);Q=c("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(H,I,{w:O,h:K},L)}else{P=D(V,W,I.yaw,I.pitch,I.fov,O,K);Q=c("SphericalMediaTaggingUtils").getSpatialTagArea(H,I,{w:O,h:K})}S=H.centerXY;R=c("SphericalMediaTaggingUtils").pointsToRectSize(Q);T=this.$SphericalPhotoController9(H)}else return}else{P=this.__getViewportMousePosition(G);R={w:100};if(!P)return;var X=void 0;if(N){X=c("SphericalPhotoProjectionUtils").convert2dTo3d(P.x,P.y,I,O,K,L);if(!X)return}else X=c("SphericalProjectionUtils").convert2dTo3dScaled(P.x,P.y,I.yaw,I.pitch,I.fov,O,K);S=c("SphericalMediaTaggingUtils").yawPitchToPhotoXY(c("normalizeDeltaYaw")(X.yaw),X.pitch,M);T=null}if(S.y<0||S.y>1)return;this.props.tagger.addSpatialTag({screenPos:P,photoXY:S,suggestion:T,size:R.w,fromTag:!!H,inTaggingMode:this.props.taggingMode},G);this.props.dispatch(p())};E.prototype.$SphericalPhotoController10=function(G){__p&&__p();var H=this.$SphericalPhotoController7(G);if(H)if(H.type!==y){this.props.dispatch(n());H.url&&c("goURI")(H.url,true);return}else{if(!this.props.tagger)return;var I=this.props,J=I.height,K=I.partialLimits,L=I.showNewPhotoRenderer,M=I.width,N=H.center,O=N.yaw,P=N.pitch,Q=this.__getViewData(),R=void 0;if(L)R=c("SphericalPhotoProjectionUtils").convert3dTo2d(O,P,Q,M,J,K);else R=D(O,P,Q.yaw,Q.pitch,Q.fov,M,J);var S=H.centerXY,T=void 0;if(L)T=c("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(H,Q,{w:M,h:J},K);else T=c("SphericalMediaTaggingUtils").getSpatialTagArea(H,Q,{w:M,h:J});var U=c("SphericalMediaTaggingUtils").pointsToRectSize(T),V=this.$SphericalPhotoController9(H);this.props.tagger.addSpatialTag({screenPos:R,photoXY:S,suggestion:V,size:U.w,fromTag:true,inTaggingMode:this.props.taggingMode},G);this.props.dispatch(p())}else if(this.props.isTagging){this.props.tagger.hideTagger();this.props.dispatch(q())}};E.prototype.$SphericalPhotoController9=function(G){__p&&__p();if(!this.props.tagger||this.props.tagger.faceboxes.length<1)return null;var H=null,I=this.props.tagger.faceboxes;I.forEach(function(J){var K=J.rect,L=K.l,M=K.r,N=K.t,O=K.b,P={x:L+(M-L)/2,y:N+(O-N)/2};try{var Q=JSON.parse(J.node.getAttribute("data-recognizeduids"));if(c("SphericalMediaTaggingUtils").coordinatesAreClose(P,G.centerXY)&&Q.length>0)H=J}catch(R){H=null}});return H};E.prototype.__onUpdateViewportEnd=function(){this.props.dispatch(r({isPanning:false}))};E.prototype.__onSignificantMove=function(G){this.props.dispatch(o(G))};E.prototype.__updateFOV=function(G){this.props.viewStore.dispatch(B(G))};E.prototype.__getViewData=function(){var G=this.props.viewStore.getState(),H=G.view;return{fov:H.fov,pitch:H.pitch,yaw:H.yaw}};E.__subClassMethods={__getViewData:true,__onUpdateViewportBegin:true,__onUpdateViewportMoveStart:true,__onDOMClick:true,__onUpdateViewportEnd:true,__onViewportChange:true,__onInitialViewportChange:true,__onZoomStart:true,__onMouseEnter:true,__onMouseMove:true,__onSignificantMove:true,__updateFOV:true};var F=function F(G){var H=G.base;return{aspectRatio:H.aspectRatio,caption:H.caption,enableGyro:H.enableGyro,enableRubberBanding:H.enableRubberBanding,enableTagging:H.enableTagging&&!c("SphericalPhotoConfig").enable_stereograph_renderer,enableZoom:H.enableZoom,height:H.height,initialFov:H.initialFov,initialPitch:H.initialPitch,initialYaw:H.initialYaw,isActive:H.isRendererActive&&H.isRendererSetup||H.showFallbackUI,isTagging:H.isTagging,keyboardVelocityFactor:H.keyboardVelocityFactor,maxTileLevel:H.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:H.panningVelocityFactor,partialLimits:H.partialLimits,photoSphereMetadata:G.base.photoSphereMetadata,tagger:H.tagger,taggingMode:H.taggingMode,tags:H.tags,showNewPhotoRenderer:H.tiledSphericalConfig.useTiledRenderer&&c("SphericalPhotoConfig").show_new_renderer,viewStore:H.viewStore,width:H.width}};f.exports=j(F)(E)}),null);
__d("SphericalPhotoFallbackMiddleware",["SphericalMediaBaseActions","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalMediaBaseActions").useFallbackUI,i=c("SphericalMediaBaseActions").disableTagging,j=function j(k){var l=k.dispatch,m=k.getState;return function(n){return function(o){if(o.type===c("SphericalMediaActions").WEBGL_INIT_FAILED){l(i());l(h())}return n(o)}}};f.exports=j}),null);
__d("CubemapImageTile",[],(function a(b,c,d,e,f,g){"use strict";function h(i,j){this.$CubemapImageTile1=i;this.$CubemapImageTile2=j}h.prototype.getInfo=function(){return this.$CubemapImageTile1};h.prototype.getImg=function(){return this.$CubemapImageTile2};f.exports=h}),null);
__d("CubemapImageTileInfo",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k,l){this.level=i;this.face=j;this.col=k;this.row=l}h.prototype.getKey=function(){return""+this.level+"_"+this.face+"_"+this.col+"_"+this.row};h.prototype.getInfoForOffsetLevel=function(i){var j=this.level-i;if(j<0)throw new Error("Invalid level offset for getKeyForOffsetLevel: "+i+", max offset: "+this.level);var k=Math.floor(this.col/Math.pow(2,i)),l=Math.floor(this.row/Math.pow(2,i));return new h(j,this.face,k,l)};f.exports=h}),null);
__d("CubemapImageTileProvider",["Bootloader","CubemapImageTile","CubemapImageTileInfo","SphericalPhotoTypedConfig","SphericalMediaConstants","URI","performanceNow"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalMediaConstants").TILED_CUBE_FACES,i=c("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE,j=c("SphericalMediaConstants").TILED_CUBE_TILE_PADDING_PIXELS;function k(l,m,n){__p&&__p();this.$CubemapImageTileProvider15=function(o,p,q){var r=new Image(),s=new(c("CubemapImageTile"))(o,r);r.crossOrigin="anonymous";r.onload=function(){return this.$CubemapImageTileProvider16(s,q)}.bind(this);r.src=p;r.onerror=function(){return this.$CubemapImageTileProvider17(r,o)}.bind(this)}.bind(this);this.$CubemapImageTileProvider1=l;this.$CubemapImageTileProvider10=0;this.$CubemapImageTileProvider11={};this.$CubemapImageTileProvider2=false;this.$CubemapImageTileProvider3=[];this.$CubemapImageTileProvider4=[];this.$CubemapImageTileProvider5=new Map();this.$CubemapImageTileProvider6=new Map();this.$CubemapImageTileProvider7=false;this.$CubemapImageTileProvider8=[];this.$CubemapImageTileProvider9=new Map();this.$CubemapImageTileProvider12=m;this.$CubemapImageTileProvider13();if(n&&n.length)this.$CubemapImageTileProvider14(n);else this.$CubemapImageTileProvider7=true}k.prototype.getTileContentSize=function(){return i};k.prototype.getTilePaddingPixels=function(){return j};k.prototype.getTileTotalSize=function(){return 2*j+i};k.prototype.getMaxTileLevel=function(){return this.$CubemapImageTileProvider12};k.prototype.getTotalPixelsLoaded=function(){return this.$CubemapImageTileProvider10*Math.pow(this.getTileTotalSize(),2)};k.prototype.getBaseLevelImageTiles=function(){return this.$CubemapImageTileProvider5};k.prototype.getViewportImageTiles=function(){return this.$CubemapImageTileProvider9};k.prototype.addBaseLevelReadyCallback=function(l){if(!this.$CubemapImageTileProvider2)this.$CubemapImageTileProvider3.push(l);else l()};k.prototype.isBaseLevelReady=function(){return this.$CubemapImageTileProvider2};k.prototype.isViewportReady=function(){return this.$CubemapImageTileProvider7};k.prototype.loadTileImage=function(l,m,n){var o=l.getKey();if(o in this.$CubemapImageTileProvider11)m(this.$CubemapImageTileProvider11[o],n);else this.$CubemapImageTileProvider1.getUriForTile(l,function(l,p){this.$CubemapImageTileProvider15(l,p,m)}.bind(this))};k.prototype.$CubemapImageTileProvider13=function(){this.$CubemapImageTileProvider4=[new(c("CubemapImageTileInfo"))(0,h.PLUS_X,0,0),new(c("CubemapImageTileInfo"))(0,h.MINUS_X,0,0),new(c("CubemapImageTileInfo"))(0,h.PLUS_Y,0,0),new(c("CubemapImageTileInfo"))(0,h.MINUS_Y,0,0),new(c("CubemapImageTileInfo"))(0,h.PLUS_Z,0,0),new(c("CubemapImageTileInfo"))(0,h.MINUS_Z,0,0)];this.$CubemapImageTileProvider4.forEach(function(l){return this.$CubemapImageTileProvider1.getUriForTile(l,this.$CubemapImageTileProvider15)}.bind(this))};k.prototype.$CubemapImageTileProvider14=function(l){l.forEach(function(m){var n=new(c("CubemapImageTileInfo"))(m.level,m.face,m.col,m.row);this.$CubemapImageTileProvider8.push(n);this.$CubemapImageTileProvider15(n,m.uri)}.bind(this))};k.prototype.$CubemapImageTileProvider17=function(l,m){__p&&__p();c("Bootloader").loadModules(["SphericalPhotoViewerTypedLogger","SphericalPhotoViewerLogEvents"],function(o,p){var q=new o();q.setName(p.CDN_IMAGE_FAILURE).setErrorMessage(m.getKey()).log()},"CubemapImageTileProvider");if(!c("SphericalPhotoTypedConfig").is_www_img_retry_on)return;if(!this.$CubemapImageTileProvider6.has(m.getKey()))this.$CubemapImageTileProvider6.set(m.getKey(),0);var n=this.$CubemapImageTileProvider6.get(m.getKey());if(typeof n==="number"&&!isNaN(n)&&n<10)setTimeout(function(){var o=new(c("URI"))(l.src);l.src=o.addQueryData("time",Date.now().toString()).toString();this.$CubemapImageTileProvider6.set(m.getKey(),n+1)}.bind(this),500)};k.prototype.$CubemapImageTileProvider16=function(l,m){__p&&__p();var n=l.getInfo().getKey();this.$CubemapImageTileProvider11[n]=l;this.$CubemapImageTileProvider10++;if(!this.$CubemapImageTileProvider2){var o=this.$CubemapImageTileProvider4.every(function(q){return q.getKey()in this.$CubemapImageTileProvider11}.bind(this)),p=this.$CubemapImageTileProvider8.length?this.$CubemapImageTileProvider8.every(function(q){return q.getKey()in this.$CubemapImageTileProvider11}.bind(this)):true;if(l.getInfo().level===0)this.$CubemapImageTileProvider5.set(l.getInfo().getKey(),l);else this.$CubemapImageTileProvider9.set(l.getInfo().getKey(),l);if(o&&p)this.$CubemapImageTileProvider18()}else m&&m(l,c("performanceNow")())};k.prototype.$CubemapImageTileProvider18=function(){this.$CubemapImageTileProvider2=true;this.$CubemapImageTileProvider7=true;this.$CubemapImageTileProvider3.forEach(function(l){return l()})};f.exports=k}),null);
__d("BaseCubemapTileUriProvider",["invariant","CubemapImageTileInfo"],(function a(b,c,d,e,f,g,h){"use strict";i.prototype.getUriForTile=function(j,k){h(0)};function i(){}f.exports=i}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/spherical_media/photo/tile/",{})}),null);
__d("EntPhotoCubemapTileUriProvider",["Promise","BaseCubemapTileUriProvider","CubemapImageTileInfo","XAsyncRequest","XSphericalPhotoTileURIsAsyncController","flattenPHPQueryData","throttle"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=200;h=babelHelpers.inherits(k,c("BaseCubemapTileUriProvider"));i=h&&h.prototype;function k(l,m){__p&&__p();i.constructor.call(this);this.$EntPhotoCubemapTileUriProvider9=c("throttle")(function(){this.$EntPhotoCubemapTileUriProvider10(this.$EntPhotoCubemapTileUriProvider3);this.$EntPhotoCubemapTileUriProvider3=new Map()}.bind(this),j);this.$EntPhotoCubemapTileUriProvider1=l;this.$EntPhotoCubemapTileUriProvider2=new Map();this.$EntPhotoCubemapTileUriProvider3=new Map();this.$EntPhotoCubemapTileUriProvider4=new Map();this.$EntPhotoCubemapTileUriProvider5=new Map();this.$EntPhotoCubemapTileUriProvider7(m);this.$EntPhotoCubemapTileUriProvider6=0}k.prototype.getUriForTile=function(l,m){var n=l.getKey(),o=this.$EntPhotoCubemapTileUriProvider2.get(n);if(!o){if(this.$EntPhotoCubemapTileUriProvider5.has(n))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:l,onURIfetched:m})}else m(l,o)};k.prototype.$EntPhotoCubemapTileUriProvider8=function(l){var m=l.tileInfo.getKey(),n=this.$EntPhotoCubemapTileUriProvider3.get(m),o=this.$EntPhotoCubemapTileUriProvider4.get(m);if(!n&&!o){this.$EntPhotoCubemapTileUriProvider3.set(m,l);this.$EntPhotoCubemapTileUriProvider9()}};k.prototype.$EntPhotoCubemapTileUriProvider10=function(l){__p&&__p();if(l.size===0)return new(c("Promise"))(function(){});var m=[];l.forEach(function(o){var p=o.tileInfo;this.$EntPhotoCubemapTileUriProvider4.set(p.getKey(),p);m.push({level:p.level,face:p.face,col:p.col,row:p.row})}.bind(this));var n={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:m};return this.$EntPhotoCubemapTileUriProvider11(c("XSphericalPhotoTileURIsAsyncController").getURIBuilder().getURI(),n).then(function(o){this.$EntPhotoCubemapTileUriProvider7(o.payload);l.forEach(function(p){var q=p.tileInfo,r=p.onURIfetched,s=q.getKey(),t=this.$EntPhotoCubemapTileUriProvider2.get(s);if(t)r(q,t);else this.$EntPhotoCubemapTileUriProvider5.set(s,true);this.$EntPhotoCubemapTileUriProvider4["delete"](s)}.bind(this))}.bind(this),function(o){}.bind(this))};k.prototype.$EntPhotoCubemapTileUriProvider11=function(l,m){return new(c("Promise"))(function(n,o){return new(c("XAsyncRequest"))(l).setMethod("POST").setData(c("flattenPHPQueryData")(m)).setHandler(n).setErrorHandler(o).send()})};k.prototype.$EntPhotoCubemapTileUriProvider7=function(l){l.forEach(function(m){var n=new(c("CubemapImageTileInfo"))(m.level,m.face,m.col,m.row);this.$EntPhotoCubemapTileUriProvider2.set(n.getKey(),m.uri)}.bind(this))};f.exports=k}),null);
__d("StaticCubemapTileUriProvider",["BaseCubemapTileUriProvider","CubemapImageTileInfo"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("BaseCubemapTileUriProvider"));i=h&&h.prototype;function j(k){i.constructor.call(this);this.$StaticCubemapTileUriProvider1=new Map();k.forEach(function(l){var m=new(c("CubemapImageTileInfo"))(l.level,l.face,l.col,l.row);this.$StaticCubemapTileUriProvider1.set(m.getKey(),l.uri)}.bind(this))}j.prototype.getUriForTile=function(k,l){var m=k.getKey(),n=this.$StaticCubemapTileUriProvider1.get(m);n&&l(k,n)};f.exports=j}),null);
__d("BaseRotatableWebGLRenderer",["EventEmitter","EventListener","getErrorNameFromWebGLErrorCode","gl-matrix","performanceNow","radToDeg","requestAnimationFrame"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("gl-matrix").glMatrix,k=c("gl-matrix").mat4,l=Math.max(window.devicePixelRatio||1,1),m=179;h=babelHelpers.inherits(n,c("EventEmitter"));i=h&&h.prototype;function n(o){__p&&__p();i.constructor.call(this);this.__handleContextLost=function(q){q.preventDefault();this.emit("renderingContextLost");this.__contextLost=true}.bind(this);this.__handleContextRestore=function(q){this.__setup();this.emit("renderingContextRestore")}.bind(this);if(!this.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var p in this.constructor.__subClassMethods)if(typeof this[p]!=="function")throw new Error('Must implement "'+p+'"');this.__firstRenderTime=-1;this.__previousRenderFinishTime=-1;this.__sumOfRenderTimes=0;this.$BaseRotatableWebGLRenderer1=-1;this.__framesRenderedCount=0;this.__sumTextureScreenRatioValues=0;this.__textureScreenRatioMillisCounted=0;this.__canvas=o;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__shaders=[];this.__contextLost=false;this.__horizontalFieldOfView=0;this.__verticalFieldOfView=0;this.__perspectiveMatrix=k.create();this.__rotationMatrix=k.create();this.__shouldEnableBlend=false;this.__useVfovAsIs=false;this.__canvas.addEventListener("webglcontextlost",this.__handleContextLost);this.__canvas.addEventListener("webglcontextrestored",this.__handleContextRestore)}n.prototype.destroy=function(){this.__canvas.removeEventListener("webglcontextlost",this.__handleContextLost);this.__canvas.removeEventListener("webglcontextrestored",this.__handleContextRestore);this.__shaders.forEach(function(o){try{this.__gl.detachShader(this.__shaderProgram,o)}catch(p){}}.bind(this));this.__shaders=[];this.__clearCache();this.__destroyed=true};n.prototype.updateFieldOfView=function(o){var p=Math.min(o,m/this.__aspectRatio);if(this.__useVfovAsIs)p=o;var q=Math.min(m,p);this.__verticalFieldOfView=q;this.__updateHorizontalFieldOfView();this.__updatePerspective()};n.prototype.updateViewportDimensions=function(o,p){this.__canvas.width=o*l;this.__canvas.height=p*l;this.__aspectRatio=this.__canvas.width/this.__canvas.height||1;this.__updateHorizontalFieldOfView();this.__updatePerspective()};n.prototype.hasRenderingContext=function(){return!this.__contextLost};n.prototype.getScreenshotDataURL=function(o,p,q){if(!this.__gl||this.__contextLost)return"";this.render(o);return this.__canvas.toDataURL(p,q)};n.prototype.getAverageFrameRenderTimeMillis=function(){if(this.__framesRenderedCount===0)return 0;return this.__sumOfRenderTimes/this.__framesRenderedCount};n.prototype.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes()};n.prototype.getAverageTextureToScreenPixelRatio=function(){if(this.__textureScreenRatioMillisCounted===0)return 0;return this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted};n.prototype.getTimeSinceFirstRenderMillis=function(){return c("performanceNow")()-this.__firstRenderTime};n.prototype.renderErrorCheck=function(){this.__createTexture()};n.prototype.render=function(o){__p&&__p();if(this.__contextLost||this.__destroyed)return;this.__view=o;if(!this.__isValidView(o)){this.emit("renderingError",new Error("invalid view"),o);return}var p=c("performanceNow")();if(this.__firstRenderTime===-1)this.__firstRenderTime=p;if(o.fov!==this.__verticalFieldOfView)this.updateFieldOfView(o.fov);k.identity(this.__rotationMatrix);k.rotateX(this.__rotationMatrix,this.__rotationMatrix,-j.toRadian(o.pitch));k.rotateY(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(o.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);var q=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var r=c("performanceNow")();this.__sumOfRenderTimes+=r-p;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){var s=2e3,t=Math.min(r-this.__previousRenderFinishTime,s);this.__sumTextureScreenRatioValues+=t*q;this.__textureScreenRatioMillisCounted+=t}this.__previousRenderFinishTime=r};n.prototype.renderWithRotationMatrixForMSite=function(o){k.rotateX(o,o,j.toRadian(90));this.renderWithRotationMatrix(o)};n.prototype.renderWithRotationMatrix=function(o){if(this.__contextLost)return;this.__rotationMatrix=o;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);this.__renderInternal()};n.prototype.__isValidView=function(o){return!Number.isNaN(o.fov+o.pitch+o.yaw)};n.prototype.__copyTextureToGLBuffer=function(o,p){var q=arguments.length<=2||arguments[2]===undefined?false:arguments[2],r=this.__getNewGLTexObj(p);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,q);this.__gl.bindTexture(this.__gl.TEXTURE_2D,r);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,o.image);this.$BaseRotatableWebGLRenderer2();return r};n.prototype.__setup=function(){__p&&__p();if(!this.__gl||!this.__contextLost){this.__gl=this.__getGL();this.__contextLost=false}this.__gl.clearColor(0,0,0,1);if(this.__shouldEnableBlend){this.__gl.enable(this.__gl.BLEND);this.__gl.blendFunc(this.__gl.SRC_ALPHA,this.__gl.ONE_MINUS_SRC_ALPHA)}this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var o=this.__initShaders();if(!o.success){var p=c("getErrorNameFromWebGLErrorCode")(this.__gl.getError());throw new Error("\n        Failed to intialize shaders: "+p+"\n        Error Message: "+o.error+"\n      ")}};n.prototype.__getGL=function(){__p&&__p();if(this.__gl&&!this.__contextLost)return this.__gl;if(!b.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");var o=["webgl","experimental-webgl","webkit-3d","moz-webgl"],p=null,q=null,r=c("EventListener").listen(this.__canvas,"webglcontextcreationerror",function(t){return q=t.statusMessage});for(var s=0;s<o.length;s++){try{p=this.__canvas.getContext(o[s])}catch(t){}if(p)break}r.remove();if(!p){q=q||"Unknown error.";throw new Error("Failed to acquire 3D rendering context: "+q)}return p};n.prototype.__updatePerspective=function(){k.perspective(this.__perspectiveMatrix,j.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100);this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight)};n.prototype.__initShaders=function(){__p&&__p();this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram)}catch(o){return{success:false,error:"Shader: "+o.message}}this.__gl.linkProgram(this.__shaderProgram);var p=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!p)return{success:false,error:"No link. Could not initialize shaders"};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return{success:true,error:""}};n.prototype.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName());this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName())};n.prototype.__getShaderConfigs=function(){var o=new Map();o.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());o.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return o};n.prototype.__attachShaders=function(o){var p=this.__getShaderConfigs();p.forEach(function(q,r){var s=this.__gl.createShader(r);this.__gl.shaderSource(s,q);this.__gl.compileShader(s);if(!this.__gl.getShaderParameter(s,this.__gl.COMPILE_STATUS))throw new Error(this.__gl.getShaderInfoLog(s));this.__gl.attachShader(o,s);this.__shaders.push(s)}.bind(this))};n.prototype.__getNewGLTexObj=function(o){var p=this.__gl.createTexture();this.__gl.bindTexture(o,p);this.__gl.texParameteri(o,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(o,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(o,null);return p};n.prototype.__updateHorizontalFieldOfView=function(){var o=j.toRadian(this.__verticalFieldOfView),p=2*Math.atan(Math.tan(o/2)*this.__aspectRatio);this.__horizontalFieldOfView=c("radToDeg")(p)};n.prototype.__emitRenderingError=function(o){this.emit("renderingError",new Error("WebGL Error Code: "+o))};n.prototype.$BaseRotatableWebGLRenderer2=function(){var o=c("performanceNow")()-this.$BaseRotatableWebGLRenderer1;if(o>1e3)c("requestAnimationFrame")(function(){this.$BaseRotatableWebGLRenderer1=c("performanceNow")();var p=this.__gl.getError();if(p!==0)this.__emitRenderingError(p)}.bind(this))};f.exports=n}),null);
__d("StereographicProjectionUtils",["gl-matrix"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("gl-matrix").vec2,i=c("gl-matrix").vec3,j=c("gl-matrix").mat3,k=c("gl-matrix").mat4,l={tiledCubeMapStereographProject:function m(n,o,p,q,r,s,t,u){var v=1.1,w=h.fromValues(r,s),x=h.scale(h.create(),w,.5/v),y=x[0]*x[0]+x[1]*x[1],z=i.scale(i.create(),i.fromValues(2*x[0],2*x[1],y-1),1/(y+1)),A=t[o],B=j.multiply(j.create(),A,j.fromMat4(j.create(),u)),C=i.transformMat3(i.create(),z,B);if(C[2]>0)return h.fromValues(NaN,NaN);var D=h.fromValues(.5*C[0]/C[2]+.5,-.5*C[1]/C[2]+.5),E=Math.pow(2,n),F=h.fromValues(D[0]*E-p,D[1]*E-q);return F},tiledCubeMapStereographUnproject:function m(n,o,p,q,r,s){var t=r[o],u=j.multiply(j.create(),t,j.fromMat4(j.create(),s)),v=j.invert(j.create(),u),w=Math.pow(2,n),x=2/w,y=i.fromValues(1-x*p,-1+x*q,-1),z=i.transformMat3(i.create(),y,v);i.normalize(z,z);var A=z[0]/(1-z[2]),B=z[1]/(1-z[2]),C=1.1,D=A*C/.5,E=B*C/.5;return h.fromValues(D,E)},cubeMapTileIsInView:function m(n,o,p,q,r,s,t,u){__p&&__p();var v=t[1][0],w=t[1][1],x=false,y=[];for(var z=0;z<=1;z++)for(var A=0;A<=1;A++){var B=this.tiledCubeMapStereographUnproject(n,o,p+A,q+z,r,s),C=B[0],D=B[1];y.push([C,D]);if(C>-v&&C<v&&D>-w&&D<w)x=true}var E=function(A,z){var L=this.tiledCubeMapStereographProject(n,o,p,q,A,z,r,s),C=L[0],D=L[1];if(C&&D&&C>0&&C<1&&D>0&&D<1)x=true}.bind(this);if(!x)E(-v,-w);if(!x)E(v,-w);if(!x)E(-v,w);if(!x)E(v,w);if(!x)E(0,0);if(!x)E(.5*-v,.5*-w);if(!x)E(.5*v,.5*-w);if(!x)E(.5*-v,.5*w);if(!x)E(.5*v,.5*w);var F=i.length(i.subtract(i.create(),i.fromValues(y[0][0],y[0][1],0),i.fromValues(y[1][0],y[1][1],0))),G=i.length(i.subtract(i.create(),i.fromValues(y[1][0],y[1][1],0),i.fromValues(y[3][0],y[3][1],0))),H=i.length(i.subtract(i.create(),i.fromValues(y[3][0],y[3][1],0),i.fromValues(y[2][0],y[2][1],0))),I=i.length(i.subtract(i.create(),i.fromValues(y[2][0],y[2][1],0),i.fromValues(y[0][0],y[0][1],0))),J=u.width/(2*t[1][0]),K=Math.max(Math.max(F,G),Math.max(H,I))*J;return{inlier:x,longestSide:K}}};f.exports=l}),null);
__d("TileRendererState",["CubemapImageTileInfo"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=1e3,i=1e3;function j(k,l){this.tileInfo=k;this.blendingProgress=0;this.closestCoveringTile=l;this.closestPrevTile=l;this.durationInViewMS=0;this.isInView=true}j.prototype.enterView=function(k){this.blendingProgress=1;this.closestCoveringTile=k;this.closestPrevTile=k;this.durationInViewMS=0;this.isInView=true};j.prototype.exitView=function(){this.closestCoveringTile=null;this.closestPrevTile=null;this.isInView=false};j.prototype.shouldFetch=function(k){return this.durationInViewMS<h&&this.durationInViewMS+k>=h};j.prototype.update=function(k,l){this.updateBlendingProgress(k,l);this.durationInViewMS+=k};j.prototype.updateBlendingProgress=function(k,l){if(!l||!this.closestCoveringTile)return;var m=l.level-this.closestCoveringTile.level;if(m>0){this.closestCoveringTile=l;this.blendingProgress=this.blendingProgress>=1?0:this.blendingProgress/(1*Math.pow(2,m))}if(this.blendingProgress<1)this.blendingProgress=Math.min(this.blendingProgress+1*k/i,1)};f.exports=j}),null);
__d("TiledSphericalRendererTextureCache",["TileRendererState","performanceNow"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k,l,m){this.TEXTURE_CACHE_LIMIT=i;this.$TiledSphericalRendererTextureCache3=j;this.$TiledSphericalRendererTextureCache5=l;this.$TiledSphericalRendererTextureCache4=k;this.$TiledSphericalRendererTextureCache6=m;this.$TiledSphericalRendererTextureCache1=new Map();this.$TiledSphericalRendererTextureCache2=new Map()}h.prototype.createTexture=function(){if(this.$TiledSphericalRendererTextureCache2.size===0&&this.$TiledSphericalRendererTextureCache3.isBaseLevelReady())this.$TiledSphericalRendererTextureCache7();if(this.$TiledSphericalRendererTextureCache1.size===0&&this.$TiledSphericalRendererTextureCache3.isViewportReady())this.$TiledSphericalRendererTextureCache8()};h.prototype.clearCache=function(){this.$TiledSphericalRendererTextureCache2.forEach(function(i){this.$TiledSphericalRendererTextureCache5.deleteTexture(i)}.bind(this));this.$TiledSphericalRendererTextureCache2.clear();this.$TiledSphericalRendererTextureCache1.forEach(function(i){this.$TiledSphericalRendererTextureCache5.deleteTexture(i.texture)}.bind(this));this.$TiledSphericalRendererTextureCache1.clear()};h.prototype.cacheTexture=function(i){__p&&__p();var j,k=this,l=i.getInfo().getKey(),m=this.$TiledSphericalRendererTextureCache1.get(l);if(!m){var n=this.$TiledSphericalRendererTextureCache6({image:i.getImg()},this.$TiledSphericalRendererTextureCache5.TEXTURE_2D);m={texture:n,lastUsedTime:c("performanceNow")()};this.$TiledSphericalRendererTextureCache1.set(l,m);if(this.$TiledSphericalRendererTextureCache1.size>this.TEXTURE_CACHE_LIMIT)(function(){var o=l,p=m;k.$TiledSphericalRendererTextureCache1.forEach(function(q,r){if(q.lastUsedTime<p.lastUsedTime){o=r;p=q}});k.$TiledSphericalRendererTextureCache5.deleteTexture(p.texture);k.$TiledSphericalRendererTextureCache1["delete"](o);k.$TiledSphericalRendererTextureCache4["delete"](o)})()}};h.prototype.getTextureCache=function(){return this.$TiledSphericalRendererTextureCache1};h.prototype.getBaseLevelTexCache=function(){return this.$TiledSphericalRendererTextureCache2};h.prototype.$TiledSphericalRendererTextureCache7=function(){var i=this.$TiledSphericalRendererTextureCache3.getBaseLevelImageTiles();i.forEach(function(j){var k=this.$TiledSphericalRendererTextureCache6({image:j.getImg()},this.$TiledSphericalRendererTextureCache5.TEXTURE_2D);this.$TiledSphericalRendererTextureCache2.set(j.getInfo().getKey(),k)}.bind(this))};h.prototype.$TiledSphericalRendererTextureCache8=function(){var i=this.$TiledSphericalRendererTextureCache3.getViewportImageTiles();i.forEach(function(j){var k=this.$TiledSphericalRendererTextureCache6({image:j.getImg()},this.$TiledSphericalRendererTextureCache5.TEXTURE_2D),l={texture:k,lastUsedTime:c("performanceNow")()};this.$TiledSphericalRendererTextureCache1.set(j.getInfo().getKey(),l)}.bind(this))};f.exports=h}),null);
__d("TiledSphericalRendererStats",["TiledSphericalRendererTextureCache"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k,l){this.$TiledSphericalRendererStats1=i;this.$TiledSphericalRendererStats2=j;this.$TiledSphericalRendererStats3=k;this.$TiledSphericalRendererStats4=l}h.prototype.getMaxGPUMemoryUsedBytes=function(){var i=this.$TiledSphericalRendererStats3.getTileTotalSize(),j=4,k=this.$TiledSphericalRendererStats2.getTextureCache().size+this.$TiledSphericalRendererStats2.getBaseLevelTexCache().size;return i*i*j*k};h.prototype.getTileToCanvasPixelRatio=function(i,j){var k=this.$TiledSphericalRendererStats4.height/j,l=90/Math.pow(2,i),m=this.$TiledSphericalRendererStats3.getTileContentSize()/l;return m/k};f.exports=h}),null);
__d("TiledSphericalRendererUtils",["CubemapImageTileInfo","SphericalMediaConstants","gl-matrix"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalMediaConstants").TILED_CUBE_FACES,i=c("gl-matrix").glMatrix,j=c("gl-matrix").mat3,k=c("gl-matrix").mat4,l=c("gl-matrix").vec3,m={fetchImage:function n(o,p,q,r,s,t){var u=o;while(!p.has(u.getKey())&&!q.has(u.getKey())){r.loadTileImage(u,s,t);u=u.getInfoForOffsetLevel(1)}},getLinePlaneIntersection:function n(o,p,q,r){var s=-p/(r-p),t=l.create();l.subtract(t,q,o);l.scale(t,t,s);l.add(t,t,o);return t},clipPolygon3D:function n(o,p){__p&&__p();var q=p[p.length-1];for(var r=0;r<p.length;r++){var s=p[r],t=[],u=l.create();l.cross(u,q,s);var v=o[o.length-1],w=l.dot(u,v),x=w>=0;for(var y=0;y<o.length;y++){var z=o[y],A=l.dot(u,z),B=A>=0;if(B!==x){var C=this.getLinePlaneIntersection(v,w,z,A);if(!l.exactEquals(v,C)&&!l.exactEquals(z,C))t.push(C)}if(B)t.push(z);v=z;w=A;x=B}o=t;if(o.length===0)break;q=s}return o},initFaceRotationMatrices:function n(o){__p&&__p();var p=[],q=[],r=[],s=k.create();k.identity(s);k.rotateY(s,s,i.toRadian(-90));p[h.PLUS_X]=s;q[h.MINUS_X]=s;var t=k.create();k.identity(t);k.rotateY(t,t,i.toRadian(90));p[h.MINUS_X]=t;q[h.PLUS_X]=t;var u=k.create();k.identity(u);k.rotateZ(u,u,i.toRadian(-180));k.rotateX(u,u,i.toRadian(-90));p[h.PLUS_Y]=u;var v=k.create();k.identity(v);k.rotateX(v,v,i.toRadian(90));q[h.PLUS_Y]=v;var w=k.create();k.identity(w);k.rotateZ(w,w,i.toRadian(180));k.rotateX(w,w,i.toRadian(90));p[h.MINUS_Y]=w;var x=k.create();k.identity(x);k.rotateX(x,x,i.toRadian(-90));q[h.MINUS_Y]=x;var y=k.create();k.identity(y);k.rotateY(y,y,i.toRadian(180));p[h.PLUS_Z]=y;q[h.MINUS_Z]=y;var z=k.create();k.identity(z);p[h.MINUS_Z]=z;q[h.PLUS_Z]=z;for(var A=0;A<6;A++){p[A]=j.fromMat4(j.create(),p[A]);q[A]=j.fromMat4(j.create(),q[A])}var B=[l.fromValues(-o,o,-o),l.fromValues(o,o,-o),l.fromValues(o,-o,-o),l.fromValues(-o,-o,-o)];for(var C=0;C<6;C++){var D=p[C],E=[];for(var F=0;F<B.length;F++){var G=l.create();l.transformMat3(G,B[F],D);E.push(G)}r[C]=E}return{faceRotationMatrices:p,faceTransformMatrices:q,faceVertexLists:r}},rotateVec3s:function n(o,p){for(var q=0;q<p.length;q++)l.transformMat3(p[q],p[q],o)}};f.exports=m}),null);
__d("TiledCubeMapStereoGraphRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","StereographicProjectionUtils","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","gl-matrix","performanceNow","throttle"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("gl-matrix").glMatrix,k=c("gl-matrix").mat3,l=c("gl-matrix").mat4,m=c("gl-matrix").vec3,n=120;h=babelHelpers.inherits(o,c("BaseRotatableWebGLRenderer"));i=h&&h.prototype;function o(p,q,r,s){__p&&__p();i.constructor.call(this,p);this.$TiledCubeMapStereoGraphRenderer41=function(t,u){var v=t.getInfo().getKey();this.$TiledCubeMapStereoGraphRenderer5.set(v,t);if(u!==this.$TiledCubeMapStereoGraphRenderer8){this.$TiledCubeMapStereoGraphRenderer8=this.$TiledCubeMapStereoGraphRenderer6;setTimeout(this.$TiledCubeMapStereoGraphRenderer42,0)}}.bind(this);this.$TiledCubeMapStereoGraphRenderer37=c("throttle")(function(){return this.__renderInternal()}.bind(this),100);this.$TiledCubeMapStereoGraphRenderer42=c("throttle")(function(){var t=this.$TiledCubeMapStereoGraphRenderer5;this.$TiledCubeMapStereoGraphRenderer5=new Map();this.$TiledCubeMapStereoGraphRenderer32();this.$TiledCubeMapStereoGraphRenderer11.forEach(function(u){return setTimeout(function(){return this.$TiledCubeMapStereoGraphRenderer43(u,t)}.bind(this),0)}.bind(this))}.bind(this),100);this.$TiledCubeMapStereoGraphRenderer1=q;this.$TiledCubeMapStereoGraphRenderer2=r;this.$TiledCubeMapStereoGraphRenderer3=1;this.$TiledCubeMapStereoGraphRenderer4=0;this.$TiledCubeMapStereoGraphRenderer6=-1;this.$TiledCubeMapStereoGraphRenderer7=-1;this.$TiledCubeMapStereoGraphRenderer8=0;this.$TiledCubeMapStereoGraphRenderer5=new Map();this.$TiledCubeMapStereoGraphRenderer10=[];this.$TiledCubeMapStereoGraphRenderer11=[];this.$TiledCubeMapStereoGraphRenderer12=new Map();this.$TiledCubeMapStereoGraphRenderer13=[];this.$TiledCubeMapStereoGraphRenderer14=new Map();this.$TiledCubeMapStereoGraphRenderer15=null;this.$TiledCubeMapStereoGraphRenderer27=0;this.__shouldEnableBlend=true;this.__useVfovAsIs=true;this.$TiledCubeMapStereoGraphRenderer28();this.__setup();this.$TiledCubeMapStereoGraphRenderer17=new(c("TiledSphericalRendererTextureCache"))(n,this.$TiledCubeMapStereoGraphRenderer1,this.$TiledCubeMapStereoGraphRenderer14,this.__gl,this.__copyTextureToGLBuffer.bind(this));this.$TiledCubeMapStereoGraphRenderer16=new(c("TiledSphericalRendererStats"))(r,this.$TiledCubeMapStereoGraphRenderer17,this.$TiledCubeMapStereoGraphRenderer1,this.__canvas)}o.prototype.updateDebugTileGradation=function(p){this.$TiledCubeMapStereoGraphRenderer27=Math.min(Math.max(p,0),1)};o.prototype.__clearCache=function(){this.$TiledCubeMapStereoGraphRenderer29();this.$TiledCubeMapStereoGraphRenderer13=[];this.$TiledCubeMapStereoGraphRenderer17.clearCache();this.$TiledCubeMapStereoGraphRenderer14.clear()};o.prototype.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};o.prototype.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};o.prototype.__shaderProgramReady=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledCubeMapStereoGraphRenderer19);var p=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),q=0;this.$TiledCubeMapStereoGraphRenderer20=this.__gl.TEXTURE0;this.__gl.uniform1i(p,q);this.$TiledCubeMapStereoGraphRenderer23=this.__gl.getUniformLocation(this.__shaderProgram,"tilesPerEdge");this.$TiledCubeMapStereoGraphRenderer24=this.__gl.getUniformLocation(this.__shaderProgram,"row");this.$TiledCubeMapStereoGraphRenderer25=this.__gl.getUniformLocation(this.__shaderProgram,"col");this.$TiledCubeMapStereoGraphRenderer26=this.__gl.getUniformLocation(this.__shaderProgram,"debugTileGradation");this.$TiledCubeMapStereoGraphRenderer30()};o.prototype.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat3 uFaceTransformMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp mat3 vFaceRotationMatrix;\n\n      void main(void) {\n        gl_Position = uPMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vFaceRotationMatrix = uFaceTransformMatrix * mat3(uRotationMatrix);\n      }\n    "};o.prototype.__getFragmentShaderScript=function(){return"\n      precision highp float;\n      const highp float DEFAULT_ZOOM = 1.1;\n\n      varying highp mat3 vFaceRotationMatrix;\n      varying highp vec3 vCurrentRay;\n\n      uniform sampler2D uContentSampler;\n\n      uniform float tilesPerEdge;\n      uniform float row;\n      uniform float col;\n      uniform float debugTileGradation;\n\n      void main(void) {\n        vec2 p = (vCurrentRay.xy * 0.5) / DEFAULT_ZOOM;\n        float pp = p.x*p.x + p.y*p.y;\n        vec3 cartesian = vec3(2.0*p, pp - 1.0) / (pp + 1.0);\n        vec3 faceVertex = vFaceRotationMatrix * cartesian;\n\n        // First compute global tex coords then convert them to local tile coords.\n        vec2 globalTexCoords = faceVertex.xy * vec2(1.0, -1.0) / faceVertex.z * 0.5 + 0.5;\n        vec2 texCoords = (globalTexCoords * tilesPerEdge - vec2(col, row)) * (510.0 / 512.0) + (1.0 / 512.0);\n\n        // If tile is behind us (+z) or outside of the tile, render transparent.\n        if (faceVertex.z > 0.0 ||\n          texCoords.s > 1.0 || texCoords.s < 0.0 || texCoords.t > 1.0 || texCoords.t < 0.0) {\n          gl_FragColor = vec4(0, 0, 0, 0);\n        } else {\n          gl_FragColor = mix(texture2D(uContentSampler, texCoords), vec4(texCoords, 1, 1), debugTileGradation);\n        }\n      }\n    "};o.prototype.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledCubeMapStereoGraphRenderer16.getMaxGPUMemoryUsedBytes()};o.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledCubeMapStereoGraphRenderer4};o.prototype.__createTexture=function(){this.$TiledCubeMapStereoGraphRenderer17.createTexture()};o.prototype.__renderInternal=function(){__p&&__p();if(this.__destroyed||!this.$TiledCubeMapStereoGraphRenderer1.isBaseLevelReady()&&!this.$TiledCubeMapStereoGraphRenderer1.isViewportReady())return;this.__createTexture();l.identity(this.__rotationMatrix);l.rotateX(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(180));l.rotateY(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(-this.__view.yaw));l.rotateX(this.__rotationMatrix,this.__rotationMatrix,j.toRadian(this.__view.pitch));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,false,this.__rotationMatrix);this.$TiledCubeMapStereoGraphRenderer31();var p=this.$TiledCubeMapStereoGraphRenderer9,q=p[1][0],r=p[1][1],s=2;this.__perspectiveMatrix=l.create();l.ortho(this.__perspectiveMatrix,-q,q,-r,r,-s,s);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,false,this.__perspectiveMatrix);this.$TiledCubeMapStereoGraphRenderer7=this.$TiledCubeMapStereoGraphRenderer6!=-1?this.$TiledCubeMapStereoGraphRenderer6:c("performanceNow")();this.$TiledCubeMapStereoGraphRenderer6=c("performanceNow")();this.$TiledCubeMapStereoGraphRenderer32();this.$TiledCubeMapStereoGraphRenderer11=this.$TiledCubeMapStereoGraphRenderer11.map(function(w){return this.$TiledCubeMapStereoGraphRenderer33(w)}.bind(this));this.$TiledCubeMapStereoGraphRenderer34();this.$TiledCubeMapStereoGraphRenderer11.sort(function(w,x){var y=function y(z){return z.level*1e3+z.face*100+z.col*10+z.row};return y(w)-y(x)});var t=0,u=false;this.$TiledCubeMapStereoGraphRenderer11.forEach(function(w){var x=this.$TiledCubeMapStereoGraphRenderer14.get(w.getKey()),y=x?x.blendingProgress:0;if(y<1)u=true;t+=this.$TiledCubeMapStereoGraphRenderer35(w)}.bind(this));var v=this.$TiledCubeMapStereoGraphRenderer11.length>0?this.$TiledCubeMapStereoGraphRenderer11.length:1;t/=v;this.$TiledCubeMapStereoGraphRenderer4=t;if(u)this.$TiledCubeMapStereoGraphRenderer36();else this.$TiledCubeMapStereoGraphRenderer29()};o.prototype.$TiledCubeMapStereoGraphRenderer36=function(){if(this.$TiledCubeMapStereoGraphRenderer15===null)this.$TiledCubeMapStereoGraphRenderer15=setInterval(function(){return this.$TiledCubeMapStereoGraphRenderer37()}.bind(this),200)};o.prototype.$TiledCubeMapStereoGraphRenderer29=function(){if(this.$TiledCubeMapStereoGraphRenderer15!==null){clearInterval(this.$TiledCubeMapStereoGraphRenderer15);this.$TiledCubeMapStereoGraphRenderer15=null}};o.prototype.$TiledCubeMapStereoGraphRenderer30=function(){var p=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),q=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),r=this.$TiledCubeMapStereoGraphRenderer2.partialLeftDegrees,s=this.$TiledCubeMapStereoGraphRenderer2.partialRightDegrees,t=this.$TiledCubeMapStereoGraphRenderer2.partialTopDegrees,u=this.$TiledCubeMapStereoGraphRenderer2.partialBottomDegrees,v=r!==undefined&&r!==null?-1*r:-181,w=s!==undefined&&s!==null?s:181,x=u!==undefined&&u!==null?-1*u:-91,y=t!==undefined&&t!==null?t:91,z=new Float32Array([j.toRadian(v),j.toRadian(w)]),A=new Float32Array([j.toRadian(x),j.toRadian(y)]);this.__gl.uniform2fv(p,z);this.__gl.uniform2fv(q,A)};o.prototype.$TiledCubeMapStereoGraphRenderer38=function(p,q,r,s){var t=new(c("CubemapImageTileInfo"))(p,q,r,s);this.$TiledCubeMapStereoGraphRenderer11.push(t);this.$TiledCubeMapStereoGraphRenderer12.set(t.getKey(),true)};o.prototype.$TiledCubeMapStereoGraphRenderer39=function(p){__p&&__p();var q=arguments.length<=1||arguments[1]===undefined?0:arguments[1],r=arguments.length<=2||arguments[2]===undefined?0:arguments[2],s=arguments.length<=3||arguments[3]===undefined?0:arguments[3],t={requireParentTile:false};if(!this.$TiledCubeMapStereoGraphRenderer9){this.$TiledCubeMapStereoGraphRenderer38(q,p,r,s);return t}var u=c("StereographicProjectionUtils").cubeMapTileIsInView(q,p,r,s,this.$TiledCubeMapStereoGraphRenderer18,this.__rotationMatrix,this.$TiledCubeMapStereoGraphRenderer9,this.__canvas);if(u.inlier){if(q===0)this.$TiledCubeMapStereoGraphRenderer38(q,p,r,s);var v=.5;if(2*v*u.longestSide<512){if(q>0)t.requireParentTile=true;return t}else if(v*u.longestSide<512){this.$TiledCubeMapStereoGraphRenderer38(q,p,r,s);return t}if(q===this.$TiledCubeMapStereoGraphRenderer1.getMaxTileLevel()){this.$TiledCubeMapStereoGraphRenderer38(q,p,r,s);return t}var w=false;for(var x=0;x<=1;x++)for(var y=0;y<=1;y++){var z=this.$TiledCubeMapStereoGraphRenderer39(p,q+1,2*r+x,2*s+y);if(z.requireParentTile)w=true}if(w)this.$TiledCubeMapStereoGraphRenderer38(q,p,r,s)}return t};o.prototype.$TiledCubeMapStereoGraphRenderer32=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer11=[];this.$TiledCubeMapStereoGraphRenderer12.clear();var p=0,q=this.$TiledCubeMapStereoGraphRenderer1.getMaxTileLevel();while(this.$TiledCubeMapStereoGraphRenderer11.length===0&&p<=q){for(var r=0;r<6;r++)for(var s=0;s<=p;s++)for(var t=0;t<=p;t++)this.$TiledCubeMapStereoGraphRenderer39(r,p,s,t);p+=1}};o.prototype.$TiledCubeMapStereoGraphRenderer34=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer13.forEach(function(p){var q=p.getKey();if(!this.$TiledCubeMapStereoGraphRenderer12.has(q)){var r=this.$TiledCubeMapStereoGraphRenderer14.get(q);if(r)r.exitView()}}.bind(this));this.$TiledCubeMapStereoGraphRenderer13=[];this.$TiledCubeMapStereoGraphRenderer11.forEach(function(p){__p&&__p();this.$TiledCubeMapStereoGraphRenderer13.push(p);var q=p.getKey(),r=this.$TiledCubeMapStereoGraphRenderer14.get(q),s=this.$TiledCubeMapStereoGraphRenderer40(p);if(!r){r=new(c("TileRendererState"))(p,s);this.$TiledCubeMapStereoGraphRenderer14.set(q,r)}else if(!r.isInView)r.enterView(s);else{var t=this.$TiledCubeMapStereoGraphRenderer6-this.$TiledCubeMapStereoGraphRenderer7;if(r.shouldFetch(t))c("TiledSphericalRendererUtils").fetchImage(p,this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache(),this.$TiledCubeMapStereoGraphRenderer17.getTextureCache(),this.$TiledCubeMapStereoGraphRenderer1,this.$TiledCubeMapStereoGraphRenderer41,this.$TiledCubeMapStereoGraphRenderer6);r.update(t,s)}}.bind(this))};o.prototype.$TiledCubeMapStereoGraphRenderer31=function(){var p=j.toRadian(this.__verticalFieldOfView),q=j.toRadian(this.__horizontalFieldOfView),r=Math.tan(q/2),s=Math.tan(p/2);this.$TiledCubeMapStereoGraphRenderer9=[m.fromValues(-r,s,-1),m.fromValues(r,s,-1),m.fromValues(r,-s,-1),m.fromValues(-r,-s,-1)]};o.prototype.$TiledCubeMapStereoGraphRenderer43=function(p,q){var r=p.getKey(),s=q.get(r);if(s){this.$TiledCubeMapStereoGraphRenderer17.cacheTexture(s);this.$TiledCubeMapStereoGraphRenderer37()}};o.prototype.$TiledCubeMapStereoGraphRenderer35=function(p){__p&&__p();var q=p.getKey(),r=void 0;r=this.$TiledCubeMapStereoGraphRenderer14.get(q);if(!r)return 0;var s=this.__gl.getUniformLocation(this.__shaderProgram,"uFaceTransformMatrix");this.__gl.uniformMatrix3fv(s,false,this.$TiledCubeMapStereoGraphRenderer18[p.face]);var t=this.$TiledCubeMapStereoGraphRenderer9,u=[t[1][0],t[1][1],-1,t[0][0],t[0][1],-1,t[2][0],t[2][1],-1,t[3][0],t[3][1],-1];this.$TiledCubeMapStereoGraphRenderer44(this.$TiledCubeMapStereoGraphRenderer19,u,3);this.__gl.activeTexture(this.$TiledCubeMapStereoGraphRenderer20);this.$TiledCubeMapStereoGraphRenderer45(p);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer23,Math.pow(2,p.level));this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer24,p.row);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer25,p.col);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer26,this.$TiledCubeMapStereoGraphRenderer27);this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,u.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledCubeMapStereoGraphRenderer10.forEach(function(v){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,v);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW);this.__gl.deleteBuffer(v)}.bind(this));this.$TiledCubeMapStereoGraphRenderer10=[];return this.$TiledCubeMapStereoGraphRenderer16.getTileToCanvasPixelRatio(p.level,this.__verticalFieldOfView)};o.prototype.$TiledCubeMapStereoGraphRenderer44=function(p,q,r){var s=this.__gl.createBuffer();this.$TiledCubeMapStereoGraphRenderer10.push(s);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,s);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(q),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(p,r,this.__gl.FLOAT,false,0,0)};o.prototype.$TiledCubeMapStereoGraphRenderer45=function(p){__p&&__p();var q=void 0;if(p.level===0)q={lastUsedTime:0,texture:this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().get(p.getKey())};else q=this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().get(p.getKey());if(q){this.__gl.bindTexture(this.__gl.TEXTURE_2D,q.texture);q.lastUsedTime=this.$TiledCubeMapStereoGraphRenderer6;return p}throw new Error("No possible tile for requested params: "+p.getKey())};o.prototype.$TiledCubeMapStereoGraphRenderer33=function(p){__p&&__p();var q=0;while(q<=p.level){var r=p.getInfoForOffsetLevel(q),s=r.getKey(),t=void 0;if(r.level===0)t={lastUsedTime:0,texture:this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().get(s)};else t=this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().get(s);if(t){t.lastUsedTime=this.$TiledCubeMapStereoGraphRenderer6;return r}if(q===0)this.$TiledCubeMapStereoGraphRenderer1.loadTileImage(r,this.$TiledCubeMapStereoGraphRenderer41,this.$TiledCubeMapStereoGraphRenderer6);q++}throw new Error("No possible tile for requested params: "+p.getKey())};o.prototype.$TiledCubeMapStereoGraphRenderer40=function(p){var q=0;while(q<=p.level){var r=p.getInfoForOffsetLevel(q),s=r.getKey();if(this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().has(s)||this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().has(s))return r;q++}throw new Error("No possible tile for requested params: "+p.getKey())};o.prototype.$TiledCubeMapStereoGraphRenderer28=function(){var p=c("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledCubeMapStereoGraphRenderer3),q=p.faceTransformMatrices;this.$TiledCubeMapStereoGraphRenderer18=q};o.__subClassMethods={__getFragmentShaderScript:true,__getVertexShaderScript:true,__getShaderPerspectiveMatrixUniformName:true,__getShaderRotationMatrixUniformName:true,__renderInternal:true,__shaderProgramReady:true,__getMaxGPUMemoryUsedBytes:true,__getPrevFrameTextureScreenRatio:true,__createTexture:true,__clearCache:true};f.exports=o}),null);
__d("TiledSphericalRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","debounceCore","gl-matrix","performanceNow","throttle"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("gl-matrix").glMatrix,k=c("gl-matrix").mat3,l=c("gl-matrix").vec3,m=44;h=babelHelpers.inherits(n,c("BaseRotatableWebGLRenderer"));i=h&&h.prototype;function n(o,p,q,r){__p&&__p();i.constructor.call(this,o);this.$TiledSphericalRenderer37=function(s,t){var u=s.getInfo().getKey();this.$TiledSphericalRenderer5.set(u,s);if(t!==this.$TiledSphericalRenderer8){this.$TiledSphericalRenderer8=this.$TiledSphericalRenderer6;setTimeout(this.$TiledSphericalRenderer38,0)}}.bind(this);this.$TiledSphericalRenderer39=c("debounceCore")(function(){return this.__renderInternal()}.bind(this),30);this.$TiledSphericalRenderer33=c("throttle")(function(){return this.__renderInternal()}.bind(this),100);this.$TiledSphericalRenderer41=c("debounceCore")(function(){var s=this.$TiledSphericalRenderer5;this.$TiledSphericalRenderer5=new Map();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer10.forEach(function(t){return setTimeout(function(){return this.$TiledSphericalRenderer40(t,s)}.bind(this),0)}.bind(this))}.bind(this),100);this.$TiledSphericalRenderer38=c("throttle")(function(){var s=this.$TiledSphericalRenderer5;this.$TiledSphericalRenderer5=new Map();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer10.forEach(function(t){return setTimeout(function(){return this.$TiledSphericalRenderer40(t,s)}.bind(this),0)}.bind(this))}.bind(this),100);this.$TiledSphericalRenderer1=p;this.$TiledSphericalRenderer2=q;this.$TiledSphericalRenderer3=1;this.$TiledSphericalRenderer4=0;this.$TiledSphericalRenderer6=-1;this.$TiledSphericalRenderer7=-1;this.$TiledSphericalRenderer8=0;this.$TiledSphericalRenderer5=new Map();this.$TiledSphericalRenderer9=[];this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer11=new Map();this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer13=new Map();this.$TiledSphericalRenderer14=null;this.$TiledSphericalRenderer26();this.__setup();this.$TiledSphericalRenderer16=new(c("TiledSphericalRendererTextureCache"))(m,this.$TiledSphericalRenderer1,this.$TiledSphericalRenderer13,this.__gl,this.__copyTextureToGLBuffer.bind(this));this.$TiledSphericalRenderer15=new(c("TiledSphericalRendererStats"))(q,this.$TiledSphericalRenderer16,this.$TiledSphericalRenderer1,this.__canvas)}n.prototype.__clearCache=function(){this.$TiledSphericalRenderer27();this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer16.clearCache();this.$TiledSphericalRenderer13.clear()};n.prototype.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};n.prototype.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};n.prototype.__shaderProgramReady=function(){__p&&__p();this.$TiledSphericalRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer19);this.$TiledSphericalRenderer20=this.__gl.getAttribLocation(this.__shaderProgram,"aTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer20);this.$TiledSphericalRenderer21=this.__gl.getAttribLocation(this.__shaderProgram,"aBGTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer21);var o=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),p=this.__gl.getUniformLocation(this.__shaderProgram,"uBackgroundSampler"),q=0;this.$TiledSphericalRenderer23=this.__gl.TEXTURE0;var r=1;this.$TiledSphericalRenderer24=this.__gl.TEXTURE1;this.__gl.uniform1i(o,q);this.__gl.uniform1i(p,r);this.$TiledSphericalRenderer22=this.__gl.getAttribLocation(this.__shaderProgram,"aPrevLevelTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer22);var s=this.__gl.getUniformLocation(this.__shaderProgram,"uPrevLevelSampler"),t=2;this.$TiledSphericalRenderer25=this.__gl.TEXTURE2;this.__gl.uniform1i(s,t);this.$TiledSphericalRenderer28()};n.prototype.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n      attribute vec2 aPrevLevelTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n        vPrevLevelTextureCoord = aPrevLevelTextureCoord;\n      }\n    "};n.prototype.__getFragmentShaderScript=function(){return"\n      #define PI 3.1415926538\n\n      precision highp float;\n      // 1 degree blend zone\n      const highp float blendDist = PI / 180.0;\n\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      varying highp vec3 vCurrentRay;\n      uniform highp vec2 uHorizontalAngleBounds;\n      uniform highp vec2 uVerticleAngleBounds;\n\n      uniform sampler2D uContentSampler;\n      uniform sampler2D uBackgroundSampler;\n      uniform sampler2D uPrevLevelSampler;\n\n      uniform float progress;\n\n      void main(void) {\n        highp float x = vCurrentRay[0];\n        highp float y = vCurrentRay[1];\n        highp float z = vCurrentRay[2];\n        highp float hAngle = atan(x, -1.0 * z);\n        highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n        // if current ray is inside the content bounds, use the content sampler\n        // to set the fragment color. if it is not within the bounds, use the\n        // background sampler to set the color.*\n\n        highp float hdist = 0.0;\n        highp float vdist = 0.0;\n        if (hAngle < uHorizontalAngleBounds[0]) {\n          hdist = uHorizontalAngleBounds[0] - hAngle;\n        } else if (hAngle > uHorizontalAngleBounds[1]) {\n          hdist = hAngle - uHorizontalAngleBounds[1];\n        }\n        if (vAngle < uVerticleAngleBounds[0]) {\n          vdist = uVerticleAngleBounds[0] - vAngle;\n        } else if (vAngle > uVerticleAngleBounds[1]) {\n          vdist = vAngle - uVerticleAngleBounds[1];\n        }\n        highp float maxDist = max(hdist, vdist);\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        highp vec4 contentColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n        if (maxDist > 0.0) {\n          // Inside this condition, our fragment is outside the content bounds.\n          // The distance outside the bound is represented by maxDist. It could\n          // be the horizontal or vertical distance from a bound, whichever is\n          // larger. We will use this distance to blend the content with the\n          // background, if the distance is smaller than blendDist. If it is\n          // larger than blendDist, we will use purely the background tex to\n          // set the color. If dist is within the blendDist, then we will set\n          // the color to the linearly weighted avg across the blend zone of the\n          // background and content colors.\n          //\n          if (maxDist < blendDist) {\n            highp float contentWeight = (blendDist - maxDist) / blendDist;\n            gl_FragColor = mix(bgColor, contentColor, contentWeight);\n          } else {\n            // We are outside the blend zone. Just use background.\n            gl_FragColor = bgColor;\n          }\n        } else {\n          // In this condition, we are inside the content\n          highp vec4 prevLevelColor = texture2D(\n            uPrevLevelSampler,\n            vec2(vPrevLevelTextureCoord.s, vPrevLevelTextureCoord.t)\n          );\n          gl_FragColor = mix(prevLevelColor, contentColor, progress);\n        }\n      }\n      "};n.prototype.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledSphericalRenderer15.getMaxGPUMemoryUsedBytes()};n.prototype.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer4};n.prototype.__createTexture=function(){this.$TiledSphericalRenderer16.createTexture()};n.prototype.__renderInternal=function(){__p&&__p();if(this.__destroyed||!this.$TiledSphericalRenderer1.isBaseLevelReady()&&!this.$TiledSphericalRenderer1.isViewportReady())return;this.__createTexture();this.$TiledSphericalRenderer7=this.$TiledSphericalRenderer6!=-1?this.$TiledSphericalRenderer6:c("performanceNow")();this.$TiledSphericalRenderer6=c("performanceNow")();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer30();var o=0,p=false;this.$TiledSphericalRenderer10.forEach(function(r){var s=this.$TiledSphericalRenderer13.get(r.getKey()),t=s?s.blendingProgress:0;if(t<1)p=true;o+=this.$TiledSphericalRenderer31(r)}.bind(this));var q=this.$TiledSphericalRenderer10.length>0?this.$TiledSphericalRenderer10.length:1;o/=q;this.$TiledSphericalRenderer4=o;if(p)this.$TiledSphericalRenderer32();else this.$TiledSphericalRenderer27()};n.prototype.$TiledSphericalRenderer32=function(){if(this.$TiledSphericalRenderer14===null)this.$TiledSphericalRenderer14=setInterval(function(){return this.$TiledSphericalRenderer33()}.bind(this),200)};n.prototype.$TiledSphericalRenderer27=function(){if(this.$TiledSphericalRenderer14!==null){clearInterval(this.$TiledSphericalRenderer14);this.$TiledSphericalRenderer14=null}};n.prototype.$TiledSphericalRenderer28=function(){var o=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),p=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),q=this.$TiledSphericalRenderer2.partialLeftDegrees,r=this.$TiledSphericalRenderer2.partialRightDegrees,s=this.$TiledSphericalRenderer2.partialTopDegrees,t=this.$TiledSphericalRenderer2.partialBottomDegrees,u=q!==undefined&&q!==null?-1*q:-181,v=r!==undefined&&r!==null?r:181,w=t!==undefined&&t!==null?-1*t:-91,x=s!==undefined&&s!==null?s:91,y=new Float32Array([j.toRadian(u),j.toRadian(v)]),z=new Float32Array([j.toRadian(w),j.toRadian(x)]);this.__gl.uniform2fv(o,y);this.__gl.uniform2fv(p,z)};n.prototype.$TiledSphericalRenderer29=function(){__p&&__p();this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer11.clear();var o=this.$TiledSphericalRenderer34(),p=this.$TiledSphericalRenderer35(),q=Math.pow(2,o),r=2*this.$TiledSphericalRenderer3/q;for(var s=0;s<p.length;s++){var t=p[s];if(t){var u=Math.floor(t.minX/r),v=Math.min(Math.floor(t.maxX/r),q-1),w=Math.floor(t.minY/r),x=Math.min(Math.floor(t.maxY/r),q-1);for(var y=u;y<=v;y++)for(var z=w;z<=x;z++){var A=new(c("CubemapImageTileInfo"))(o,s,y,z);this.$TiledSphericalRenderer10.push(A);this.$TiledSphericalRenderer11.set(A.getKey(),true)}}}};n.prototype.$TiledSphericalRenderer30=function(){__p&&__p();this.$TiledSphericalRenderer12.forEach(function(o){var p=o.getKey();if(!this.$TiledSphericalRenderer11.has(p)){var q=this.$TiledSphericalRenderer13.get(p);if(q)q.exitView()}}.bind(this));this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer10.forEach(function(o){__p&&__p();this.$TiledSphericalRenderer12.push(o);var p=o.getKey(),q=this.$TiledSphericalRenderer13.get(p),r=this.$TiledSphericalRenderer36(o);if(!q){q=new(c("TileRendererState"))(o,r);this.$TiledSphericalRenderer13.set(p,q)}else if(!q.isInView)q.enterView(r);else{var s=this.$TiledSphericalRenderer6-this.$TiledSphericalRenderer7;if(q.shouldFetch(s))c("TiledSphericalRendererUtils").fetchImage(o,this.$TiledSphericalRenderer16.getBaseLevelTexCache(),this.$TiledSphericalRenderer16.getTextureCache(),this.$TiledSphericalRenderer1,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);q.update(s,r)}}.bind(this))};n.prototype.$TiledSphericalRenderer34=function(){var o=this.__verticalFieldOfView,p=this.__horizontalFieldOfView,q=this.__canvas.height/o,r=3400/2,s=0,t=this.$TiledSphericalRenderer1.getTileContentSize()/90,u=1.4;while(t*u<q&&t*o<r&&t*p<r){s++;t*=2}return Math.min(s,this.$TiledSphericalRenderer1.getMaxTileLevel())};n.prototype.$TiledSphericalRenderer35=function(){__p&&__p();var o=j.toRadian(this.__verticalFieldOfView),p=j.toRadian(this.__horizontalFieldOfView),q=1,r=Math.tan(p/2)*q,s=Math.tan(o/2)*q,t=[l.fromValues(-r,s,-q),l.fromValues(r,s,-q),l.fromValues(r,-s,-q),l.fromValues(-r,-s,-q)],u=k.create();k.transpose(u,k.fromMat4(k.create(),this.__rotationMatrix));c("TiledSphericalRendererUtils").rotateVec3s(u,t);var v=[];for(var w=0;w<6;w++){var x=this.$TiledSphericalRenderer18[w],y=[];for(var z=0;z<x.length;z++)y.push(l.clone(x[z]));var A=c("TiledSphericalRendererUtils").clipPolygon3D(y,t);if(A.length>0){var B=k.create();k.transpose(B,this.$TiledSphericalRenderer17[w]);c("TiledSphericalRendererUtils").rotateVec3s(B,A);var C=A[0],D=C[0],E=C[0],F=C[1],G=C[1];for(var H=1;H<A.length;H++){C=A[H];D=Math.min(D,C[0]);E=Math.max(E,C[0]);F=Math.min(F,C[1]);G=Math.max(G,C[1])}v[w]={minX:this.$TiledSphericalRenderer3+D,maxX:this.$TiledSphericalRenderer3+E,minY:this.$TiledSphericalRenderer3-G,maxY:this.$TiledSphericalRenderer3-F}}}return v};n.prototype.$TiledSphericalRenderer40=function(o,p){var q=o.getKey(),r=p.get(q);if(r){this.$TiledSphericalRenderer16.cacheTexture(r);this.$TiledSphericalRenderer33()}};n.prototype.$TiledSphericalRenderer31=function(o){__p&&__p();var p=o.getKey(),q=void 0,r=void 0,s=void 0;q=this.$TiledSphericalRenderer13.get(p);if(!q)return 0;r=q.closestCoveringTile;s=q.closestPrevTile;if(!r||!s)return 0;var t=2*this.$TiledSphericalRenderer3,u=this.$TiledSphericalRenderer3,v=Math.pow(2,o.level),w=t/v,x=o.col*w,y=o.row*w,z=-u+x,A=z+w,B=u-y,C=B-w,D=[[z,B,-u],[A,B,-u],[z,C,-u],[A,C,-u]],E=this.$TiledSphericalRenderer17[o.face],F=[];for(var G=0;G<D.length;G++){l.transformMat3(D[G],D[G],E);F.push(D[G][0]);F.push(D[G][1]);F.push(D[G][2])}var H={};this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer19,F,3);this.__gl.activeTexture(this.$TiledSphericalRenderer23);if(r)H=this.$TiledSphericalRenderer43(r);else H=this.$TiledSphericalRenderer44(o);var I=this.$TiledSphericalRenderer45(o,H);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer20,I,2);this.__gl.activeTexture(this.$TiledSphericalRenderer24);var J=new(c("CubemapImageTileInfo"))(0,o.face,0,0),K=this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(J.getKey());if(!K)throw new Error("[Tile] Base level should have been loaded.");this.__gl.bindTexture(this.__gl.TEXTURE_2D,K);var L=this.$TiledSphericalRenderer45(o,J);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer21,L,2);if(q&&s){this.__gl.activeTexture(this.$TiledSphericalRenderer25);H=this.$TiledSphericalRenderer43(s);var M=this.$TiledSphericalRenderer45(o,H);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer22,M,2);var N=this.__gl.getUniformLocation(this.__shaderProgram,"progress");this.__gl.uniform1f(N,q.blendingProgress)}this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,F.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer9.forEach(function(O){this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,O);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,1,this.__gl.STATIC_DRAW);this.__gl.deleteBuffer(O)}.bind(this));this.$TiledSphericalRenderer9=[];return this.$TiledSphericalRenderer15.getTileToCanvasPixelRatio(H.level,this.__verticalFieldOfView)};n.prototype.$TiledSphericalRenderer42=function(o,p,q){var r=this.__gl.createBuffer();this.$TiledSphericalRenderer9.push(r);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,r);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(p),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(o,q,this.__gl.FLOAT,false,0,0)};n.prototype.$TiledSphericalRenderer45=function(o,p){var q=this.$TiledSphericalRenderer1.getTilePaddingPixels(),r=q/this.$TiledSphericalRenderer1.getTileTotalSize(),s=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),t=Math.pow(2,o.level-p.level),u=s/t,v=o.col-t*p.col,w=o.row-t*p.row,x=r+v*u,y=r+w*u;return[x,y,x+u,y,x,y+u,x+u,y+u]};n.prototype.$TiledSphericalRenderer43=function(o){__p&&__p();var p=void 0;if(o.level===0)p={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(o.getKey())};else p=this.$TiledSphericalRenderer16.getTextureCache().get(o.getKey());if(p){this.__gl.bindTexture(this.__gl.TEXTURE_2D,p.texture);p.lastUsedTime=this.$TiledSphericalRenderer6;return o}throw new Error("No possible tile for requested params: "+o.getKey())};n.prototype.$TiledSphericalRenderer44=function(o){__p&&__p();var p=0;while(p<=o.level){var q=o.getInfoForOffsetLevel(p),r=q.getKey(),s=void 0;if(q.level===0)s={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(r)};else s=this.$TiledSphericalRenderer16.getTextureCache().get(r);if(s){this.__gl.bindTexture(this.__gl.TEXTURE_2D,s.texture);s.lastUsedTime=this.$TiledSphericalRenderer6;return q}else this.$TiledSphericalRenderer1.loadTileImage(q,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);p++}throw new Error("No possible tile for requested params: "+o.getKey())};n.prototype.$TiledSphericalRenderer36=function(o){var p=0;while(p<=o.level){var q=o.getInfoForOffsetLevel(p),r=q.getKey();if(this.$TiledSphericalRenderer16.getBaseLevelTexCache().has(r)||this.$TiledSphericalRenderer16.getTextureCache().has(r))return q;p++}throw new Error("No possible tile for requested params: "+o.getKey())};n.prototype.$TiledSphericalRenderer26=function(){var o=c("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledSphericalRenderer3),p=o.faceRotationMatrices,q=o.faceVertexLists;this.$TiledSphericalRenderer17=p;this.$TiledSphericalRenderer18=q};n.__subClassMethods={__getFragmentShaderScript:true,__getVertexShaderScript:true,__getShaderPerspectiveMatrixUniformName:true,__getShaderRotationMatrixUniformName:true,__renderInternal:true,__shaderProgramReady:true,__getMaxGPUMemoryUsedBytes:true,__getPrevFrameTextureScreenRatio:true,__createTexture:true,__clearCache:true};f.exports=n}),null);
__d("getScaledPanoDimensions",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j){__p&&__p();var k={croppedAreaImageHeightPixels:Number(i.CroppedAreaImageHeightPixels)||0,croppedAreaImageWidthPixels:Number(i.CroppedAreaImageWidthPixels)||0,croppedAreaLeftPixels:Number(i.CroppedAreaLeftPixels)||0,croppedAreaTopPixels:Number(i.CroppedAreaTopPixels)||0,fullPanoHeightPixels:Number(i.FullPanoHeightPixels)||0,fullPanoWidthPixels:Number(i.FullPanoWidthPixels)||0};if(k.croppedAreaImageWidthPixels&&j!==k.croppedAreaImageWidthPixels){var l=j/k.croppedAreaImageWidthPixels;k.croppedAreaImageWidthPixels*=l;k.croppedAreaImageHeightPixels*=l;k.croppedAreaLeftPixels*=l;k.croppedAreaTopPixels*=l;k.fullPanoHeightPixels*=l;k.fullPanoWidthPixels*=l}return k}f.exports=h}),null);
__d("SphericalPhotoRenderer.redux",["cx","Promise","Bootloader","BootloadedComponent.react","CubemapImageTileProvider","DOM","EntPhotoCubemapTileUriProvider","Event","ImageUtils","JSResource","PhotoProjection","PhotoRendererProjection","React","SphericalMediaCanvasPool","SphericalMediaRenderer.react","SphericalPhotoPartialLimits","StaticCubemapTileUriProvider","SphericalPhotoConfig","TiledCubeMapStereoGraphRenderer","TiledSphericalRenderer","joinClasses","performanceNow","uniqueID","getScaledPanoDimensions","ReactRedux","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalMediaBaseActions","SphericalPhotoActions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalPhotoPartialLimits").makePartialLimits,l=c("ReactRedux").connect,m=c("SphericalMediaCoreActions").turnOff,n=c("SphericalMediaViewActions").updateViewportAndFOV,o=c("SphericalMediaBaseActions").updateBase,p=c("SphericalMediaBaseActions").setupRenderer,q=c("SphericalMediaBaseActions").webGlInitFailed,r=c("SphericalMediaBaseActions").webGlRenderFailed,s=c("SphericalMediaBaseActions").webGlContextLost,t=c("SphericalMediaBaseActions").sourceOnLoad,u=c("SphericalMediaBaseActions").viewportClicked,v=c("SphericalPhotoActions").rendererStats,w=2;i=babelHelpers.inherits(x,c("SphericalMediaRenderer.react"));j=i&&i.prototype;function x(z){j.constructor.call(this,z);this.$SphericalPhotoRenderer11=function(){this.draw(this.__getViewData())}.bind(this);this.__sourceElement=c("DOM").create("img");this.$SphericalPhotoRenderer1=c("uniqueID")();this.$SphericalPhotoRenderer2=0;this.$SphericalPhotoRenderer3=null}x.prototype.__afterDraw=function(){};x.prototype.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer4();this.sphericalRenderer&&this.sphericalRenderer.destroy();this.sphericalRenderer=null;if(this.props.isActive)this.props.dispatch(m())};x.prototype.__getViewData=function(){var z=this.props.viewStore.getState(),A=z.view;return{fov:A.fov,pitch:A.pitch,yaw:A.yaw}};x.prototype.__getCanvas=function(){var z=this.$SphericalPhotoRenderer5();c("SphericalMediaCanvasPool").setLimit(w,z);var A={canvasAttrs:{width:this.props.width,height:this.props.height,className:c("joinClasses")(this.props.className,"_5nxw")},beforeCanvasLost:function(){return this.__beforeCanvasLost()}.bind(this)};return c("SphericalMediaCanvasPool").get(this.$SphericalPhotoRenderer1,A,z)};x.prototype.__onSetupDone=function(){this.$SphericalPhotoRenderer6()};x.prototype.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded};x.prototype.__onFallbackUIClick=function(){this.props.dispatch(u())};x.prototype.__onWebGlRenderFailed=function(z,A){this.props.dispatch(r(z,A))};x.prototype.__onWebGlContextLost=function(){this.props.dispatch(s());this.props.dispatch(m())};x.prototype.__onWebGlInitFailed=function(z){c("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace);this.props.dispatch(q(z));this.props.dispatch(m())};x.prototype.$SphericalPhotoRenderer7=function(){var z=this.props.photoSphereMetadata,A=z.ProjectionType===c("PhotoProjection").EQUIRECTANGULAR,B=z.FullPanoWidthPixels===z.CroppedAreaImageWidthPixels&&z.FullPanoHeightPixels===z.CroppedAreaImageHeightPixels;return c("SphericalPhotoConfig").enable_stereograph_renderer&&A&&B};x.prototype.__getRenderer=function(z){__p&&__p();return new(c("Promise"))(function(A,B){__p&&__p();var C,D=this,E=this.props,F=E.projectionType,G=E.photoSphereMetadata;if(this.props.tiledSphericalConfig.useTiledRenderer){var H=this.$SphericalPhotoRenderer7()?c("TiledCubeMapStereoGraphRenderer"):c("TiledSphericalRenderer");if(this.__cubemapImageTileProvider)A(new H(z,this.__cubemapImageTileProvider,this.props.partialLimits,G.ProjectionType===c("PhotoProjection").CYLINDRICAL));else throw new Error("No __cubemapImageTileProvider")}else(function(){__p&&__p();if(!D.props.imageLoaded)throw new Error("__getRenderer was called before the source has been loaded.");var I=c("getScaledPanoDimensions")(G,D.__sourceElement.width);if(F===c("PhotoProjection").EQUIRECTANGULAR)c("Bootloader").loadModules(["EquirectSphericalWebGLRenderer"],function(J){try{A(new J(this.__sourceElement,z,babelHelpers["extends"]({poseHeadingDegrees:Number(G.PoseHeadingDegrees)||0,posePitchDegrees:Number(G.PosePitchDegrees)||0,poseRollDegrees:Number(G.PoseRollDegrees)||0},I)))}catch(K){B(K)}}.bind(D),"SphericalPhotoRenderer.redux");else if(F===c("PhotoProjection").CYLINDRICAL)c("Bootloader").loadModules(["CylindricalSphericalWebGLRenderer"],function(J){try{A(new J(this.__sourceElement,z,I))}catch(K){B(K)}}.bind(D),"SphericalPhotoRenderer.redux");else c("Bootloader").loadModules(["CubestripSphericalWebGLRenderer"],function(J){try{A(new J(this.__sourceElement,z))}catch(K){B(K)}}.bind(D),"SphericalPhotoRenderer.redux")})()}.bind(this))};x.prototype.__destroy=function(){this.$SphericalPhotoRenderer4();this.$SphericalPhotoRenderer3&&this.$SphericalPhotoRenderer3();j.__destroy.call(this);c("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer5());this.__sourceElement=c("DOM").create("img");this.__cubemapImageTileProvider=null;this.props.dispatch(o({loaded:false}))};x.prototype.$SphericalPhotoRenderer5=function(){__p&&__p();var z=void 0,A=void 0;if(this.props.tiledSphericalConfig.useTiledRenderer)z=c("PhotoProjection").TILED_CUBEMAP;else if(this.props.photoSphereMetadata.ProjectionType)z=this.props.photoSphereMetadata.ProjectionType;else z=c("PhotoProjection").CUBESTRIP;if(this.$SphericalPhotoRenderer7())A=c("PhotoRendererProjection").STEREOGRAPHIC;else A=c("PhotoRendererProjection").PERSPECTIVE;return z+A+this.props.canvasNamespace};x.prototype.__showLoadingThumbnail=function(){return!this.props.taggingMode};x.prototype.$SphericalPhotoRenderer4=function(){var z=this.sphericalRenderer;if(z){var A={avg_frame_render_time:z.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:z.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:z.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:z.getMaxGPUMemoryUsedBytes(),max_tile_level:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?"tiled":"cubestrip",total_data_loaded:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getTotalPixelsLoaded():this.$SphericalPhotoRenderer8(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(v(A))}};x.prototype.$SphericalPhotoRenderer8=function(){if(this.__sourceElement&&c("ImageUtils").hasLoaded(this.__sourceElement)){var z=this.__sourceElement,A=z.width,B=z.height;return A*B}return 0};x.prototype.$SphericalPhotoRenderer9=function(z){var A,B=this,C=this.props.dispatch;c("DOM").setAttributes(this.__sourceElement,{crossOrigin:"anonymous",src:z});if(c("ImageUtils").hasLoaded(this.__sourceElement))C(t());else(function(){var D=c("Event").listen(B.__sourceElement,"load",function(){C(t());D.remove()})})()};x.prototype.$SphericalPhotoRenderer10=function(){var z=this.props,A=z.dispatch,B=z.tiledSphericalConfig;if(B.useTiledRenderer&&!this.__cubemapImageTileProvider){var C=this.props.fbid==="0"?new(c("StaticCubemapTileUriProvider"))(this.props.tiledSphericalConfig.initialTileUris):new(c("EntPhotoCubemapTileUriProvider"))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris),D=new(c("CubemapImageTileProvider"))(C,this.props.tiledSphericalConfig.maxTileLevel,this.props.tiledSphericalConfig.viewportTileUris);D.addBaseLevelReadyCallback(function(){return A(t())});this.__cubemapImageTileProvider=D}};x.prototype.$SphericalPhotoRenderer6=function(){this.$SphericalPhotoRenderer3=this.props.viewStore.subscribe(this.$SphericalPhotoRenderer11);this.draw(this.__getViewData());var z=this.sphericalRenderer;if(z){var A=c("performanceNow")()-this.$SphericalPhotoRenderer2;this.props.dispatch(p(z,A))}};x.prototype.componentDidMount=function(){var z=this.props.tiledSphericalConfig.useTiledRenderer;if(z)this.$SphericalPhotoRenderer10();else if(this.props.cubeStripImageURI)this.$SphericalPhotoRenderer9(this.props.cubeStripImageURI);if(this.props.isActive)this.$SphericalPhotoRenderer2=c("performanceNow")();j.componentDidMount.call(this)};x.prototype.UNSAFE_componentWillReceiveProps=function(z){__p&&__p();this.shouldRender=z.isActive&&!this.props.renderer||z.isActive!==this.props.isActive||z.thumbnail!==this.props.thumbnail||z.useFallbackUI!==this.props.useFallbackUI||z.width!==this.props.width||z.height!==this.props.height||z.imageLoaded&&!this.props.imageLoaded||z.renderer!==this.props.renderer;if(this.props.fbid!==z.fbid){this.shouldRender=false;this.__destroy();return}if(z.isActive&&z.isActive!==this.props.isActive)this.$SphericalPhotoRenderer2=c("performanceNow")();if(this.props.renderer&&z.projectionType!==this.props.projectionType)this.__destroy();var A=this.props.tiledSphericalConfig.useTiledRenderer;if(A)this.$SphericalPhotoRenderer10();else if(z.cubeStripImageURI&&!this.__sourceElement.src)this.$SphericalPhotoRenderer9(z.cubeStripImageURI);j.UNSAFE_componentWillReceiveProps.call(this,z)};x.prototype.componentWillUnmount=function(){this.props.viewStore.dispatch(n(this.props.initialYaw,this.props.initialPitch,this.props.initialFov));j.componentWillUnmount.call(this)};x.prototype.render=function(){if(this.props.useFallbackUI)return c("React").createElement("div",{onClick:function(){return this.__onFallbackUIClick()}.bind(this),role:"link",tabIndex:"0",className:"_kp_"},c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoFallbackCanvasWrapper.redux").__setRef("SphericalPhotoRenderer.redux"),bootloadPlaceholder:c("React").createElement("span",null)}));return j.render.call(this)};x.__subClassMethods={__afterDraw:true,__beforeCanvasLost:true,__getCanvas:true,__getRenderer:true,__getViewData:true,__onSetupDone:true,__isReadyToSetup:true,__onFallbackUIClick:true,__showLoadingThumbnail:true,__onWebGlContextLost:true,__onWebGlInitFailed:true,__onWebGlRenderFailed:true};var y=function y(z){return{className:z.base.className,expansionCoef:z.base.expansionCoef,height:z.base.height,initialFov:z.base.initialFov,initialPitch:z.base.initialPitch,initialYaw:z.base.initialYaw,isActive:z.base.isRendererActive||z.base.showFallbackUI,projectionType:z.base.projectionType,renderer:z.base.renderer,tiledSphericalConfig:z.base.tiledSphericalConfig,width:z.base.width,partialLimits:k({partialLeftDegrees:z.base.partialLimits.partialLeftDegrees,partialRightDegrees:z.base.partialLimits.partialRightDegrees,partialBottomDegrees:z.base.partialLimits.partialBottomDegrees,partialTopDegrees:z.base.partialLimits.partialTopDegrees}),fbid:z.base.fbid,isFetchingData:z.base.isFetchingData,imageLoaded:z.base.loaded,cubeStripImageURI:z.base.src,useFallbackUI:z.base.useFallbackUI,taggingMode:z.base.taggingMode,thumbnail:z.base.thumbnail,canvasNamespace:z.base.canvasNamespace,src:z.base.src,photoSphereMetadata:z.base.photoSphereMetadata,viewStore:z.base.viewStore}};f.exports=l(y)(x)}),null);
__d("SphericalPhotoStore",["SphericalMediaBaseStore","SphericalMediaBaseReducer"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("SphericalMediaBaseStore"));i=h&&h.prototype;j.prototype.getReducers=function(){return{base:c("SphericalMediaBaseReducer")}};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("SphericalPhotoFeedEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DRAG_START:0,VIEWPORT_CLICKED:1,TAP_HEADING_INDICATOR:2})}),null);
__d("SphericalPhotoViewerLoggingMiddleware",["Banzai","Bootloader","immutable","SphericalMediaActions","SphericalPhotoConfig","collectDataAttributes","SphericalPhotoConstants","SphericalPhotoFeedEvents"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SphericalPhotoConstants").FEED_TRACKING_KEY,i=Object.freeze({NEWSSTAND:"newsstand"}),j=Object.freeze({CONTENT_CLICK:175}),k=c("immutable").List(),l=function l(n,o,p){var q,r=c("collectDataAttributes")(n,["ft"]),s={ft:babelHelpers["extends"]((q={},q[h]=o,q),r.ft?r.ft:{})};if(p)s.ft.evt=p;c("Banzai").post("feed_tracking",s,{})},m=function m(n){__p&&__p();var o=n.getState,p=void 0,q=void 0;if(c("SphericalPhotoConfig").www_can_viewer_tag)c("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil","SphericalPhotoTagLoggingUtil"],function(r,s){p=r;q=s;k.forEach(function(t){p&&p.log(t.action,t.base);q&&q.log(t.action,t.base)});k=k.clear()},"SphericalPhotoViewerLoggingMiddleware");else c("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil"],function(r){p=r;k.forEach(function(s){p&&p.log(s.action,s.base)});k=k.clear()},"SphericalPhotoViewerLoggingMiddleware");return function(r){__p&&__p();return function(s){__p&&__p();var t=o();if(p){p.log(s,t.base);q&&q.log(s,t.base)}else k=k.push({action:s,base:t.base});if(t.base.surface===i.NEWSSTAND&&t.base.ctrElement)switch(s.type){case c("SphericalMediaActions").TAP_HEADING_INDICATOR:l(t.base.ctrElement,c("SphericalPhotoFeedEvents").TAP_HEADING_INDICATOR);break;case c("SphericalMediaActions").DRAG_START:l(t.base.ctrElement,c("SphericalPhotoFeedEvents").DRAG_START,j.CONTENT_CLICK);break}return r(s)}}};f.exports=m}),null);
__d("SphericalPhotoViewerWrapper.redux",["cx","BootloadedComponent.react","JSResource","React","ReactRedux"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("ReactRedux").connect;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement("div",{className:"_3o6m _5nxw"},this.props.children,this.props.showFallbackUI?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoFallbackIndicator.redux").__setRef("SphericalPhotoViewerWrapper.redux"),bootloadPlaceholder:c("React").createElement("span",null)}):null)};function l(){i.apply(this,arguments)}var m=function m(n){return{showFallbackUI:n.base.showFallbackUI}};f.exports=k(m)(l)}),null);
__d("SphericalPhotoViewer.react",["BootloadedComponent.react","JSResource","PhotoProjection","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalPhotoConfig","SphericalPhotoController.redux","SphericalPhotoFallbackMiddleware","SphericalPhotoPartialLimits","SphericalPhotoRenderer.redux","SphericalPhotoStore","SphericalPhotoTypedConfig","SphericalPhotoViewerLoggingMiddleware","SphericalPhotoViewerWrapper.redux"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("ReactRedux").Provider,k=c("SphericalMediaBaseActions").updateBase,l=c("SphericalMediaBaseActions").updateDimension,m=c("SphericalMediaCoreActions").turnOn,n=c("SphericalMediaCoreActions").turnOff,o=c("SphericalMediaViewActions").updateView,p=c("SphericalPhotoPartialLimits").makePartialLimits;h=babelHelpers.inherits(q,c("React").Component);i=h&&h.prototype;function q(r){i.constructor.call(this,r);this.__store=new(c("SphericalPhotoStore"))(this.__getMiddleware()).getStore()}q.prototype.shouldComponentUpdate=function(r){return this.props.caption!==r.caption||this.props.cubeImageURI!==r.cubeImageURI||this.props.enableTagging!==r.enableTagging||this.props.height!==r.height||this.props.initialImageURI!==r.initialImageURI||this.props.photoID!==r.photoID||this.props.surface!==r.surface||this.props.width!==r.width};q.prototype.componentWillUnmount=function(){this.__store.dispatch(n())};q.prototype.UNSAFE_componentWillMount=function(){this.__updateState();this.__store.dispatch(m())};q.prototype.componentDidUpdate=function(){this.__updateState(this.props)};q.prototype.UNSAFE_componentWillReceiveProps=function(r){if(r.photoID!==this.__store.getState().base.fbid)this.__updateState(r)};q.prototype.__getMiddleware=function(){var r=this.props.middlewares||[];return r.concat([c("SphericalPhotoViewerLoggingMiddleware"),c("SphericalPhotoFallbackMiddleware")])};q.prototype.__updateState=function(){__p&&__p();var r=arguments.length<=0||arguments[0]===undefined?this.props:arguments[0],s={enableGyro:r.enableGyro,enableZoom:r.enableZoom,enableRubberBanding:r.enableRubberBanding,visibility:true},t=void 0,u=void 0,v=void 0,w=void 0;if(r.partialLimits){t=r.partialLimits.partialLeftDegrees;u=r.partialLimits.partialRightDegrees;v=r.partialLimits.partialBottomDegrees;w=r.partialLimits.partialTopDegrees}this.__store.dispatch(k(babelHelpers["extends"]({ambientAudio:r.ambientAudio||[],enableTagging:c("SphericalPhotoConfig").www_can_viewer_tag&&r.enableTagging,initialYaw:r.initialView.yaw,initialPitch:r.initialView.pitch,initialFov:r.initialView.fov,tiledSphericalConfig:r.tiledSphericalConfig,caption:r.caption,canvasNamespace:r.canvasNamespace,fallback:r.fallback,fbid:r.photoID,partialLimits:p({partialLeftDegrees:t,partialRightDegrees:u,partialBottomDegrees:v,partialTopDegrees:w}),projectionType:r.projectionType,photoSphereMetadata:r.photoSphereMetadata||{},src:r.cubeImageURI,surface:r.surface,thumbnail:r.initialImageURI||"",useLargeHeadingIndicator:r.useLargeHeadingIndicator||false,useLargeVolumeIcon:r.useLargeVolumeIcon||false},s)));this.__store.dispatch(l(r.width,r.height));var x=this.__store.getState().base.viewStore;x.dispatch(o({yaw:r.initialView.yaw,pitch:r.initialView.pitch,fov:r.initialView.fov}))};q.prototype.render=function(){return c("React").createElement(j,{store:this.__store},c("React").createElement(c("SphericalPhotoViewerWrapper.redux"),null,c("React").createElement(c("SphericalPhotoRenderer.redux"),null),this.__store.getState().base.enableTagging?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoTagging.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null,c("React").createElement(c("SphericalPhotoController.redux"),null),c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoHeadingIndicator.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}),c("SphericalPhotoTypedConfig").allow_ambient_audio&&this.props.ambientAudio&&this.props.ambientAudio.length>0?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoVolumeControl.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null,this.props.showMouseAnimation?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalMediaMouseOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null,this.props.showGyroAnimation?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalMediaGyroOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null,this.props.showManager?c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SphericalPhotoManagerLoader").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:c("React").createElement("span",null)}):null))};q.defaultProps={canvasNamespace:"PhotoViewer",enableGyro:false,enableRubberBanding:false,enablevisibilityObserver:false,enableZoom:false,projectionType:c("PhotoProjection").CUBESTRIP,showGyroAnimation:false,showManager:false,showMouseAnimation:true,useLargeHeadingIndicator:false,useLargeVolumeIcon:false};f.exports=q}),null);
__d("SphericalPhotoViewerInFeed.react",["cx","Arbiter","Bootloader","CSS","Event","ReactDOM","SphericalMediaActions","SphericalMediaViewActions","SphericalParallaxUtils","SphericalPhotoViewer.react","SubscriptionsHandler","getElementRect","getViewportDimensions","onViewportChanged","debounce","SphericalMediaCoreActions","SphericalMediaBaseActions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalMediaViewActions").updateYaw,l=c("SphericalParallaxUtils").calculateNewYaw,m=c("SphericalMediaCoreActions").turnOn,n=c("SphericalMediaCoreActions").turnOff,o=c("SphericalMediaBaseActions").visibilityChanged,p=c("SphericalMediaBaseActions").updateFeedRootElement,q=5e3,r=50;i=babelHelpers.inherits(s,c("SphericalPhotoViewer.react"));j=i&&i.prototype;function s(){__p&&__p();var t,u;for(var v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];return u=(t=j.constructor).call.apply(t,[this].concat(w)),this.$SphericalPhotoViewerInFeed16=function(){if(this.$SphericalPhotoViewerInFeed20())return;if(this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.isOpen)return;var y=c("getViewportDimensions").withoutScrollbars(),z=y.height;this.$SphericalPhotoViewerInFeed21(z,0);this.$SphericalPhotoViewerInFeed17();this.__store.dispatch(m())}.bind(this),this.$SphericalPhotoViewerInFeed15=c("debounce")(function(y){if(!this.$SphericalPhotoViewerInFeed5)return;var z=c("getElementRect")(this.$SphericalPhotoViewerInFeed5),A=y.bottom-y.top,B=z.bottom-z.top,C=(A-B)/3,D=y.top+C,E=y.bottom-C,F=z.top>D&&z.top<E||z.bottom>D&&z.bottom<E||D>z.top&&E<z.bottom;if(this.$SphericalPhotoViewerInFeed3!==F){this.$SphericalPhotoViewerInFeed3=F;F?this.$SphericalPhotoViewerInFeed22():this.$SphericalPhotoViewerInFeed23()}}.bind(this),r),this.$SphericalPhotoViewerInFeed18=function(y){this.$SphericalPhotoViewerInFeed21(y.bottom,y.top)}.bind(this),u}s.prototype.__getMiddleware=function(){__p&&__p();var t=j.__getMiddleware.call(this),u=function(){return function(x){return function(y){if(y.type===c("SphericalMediaActions").VIEWPORT_CLICKED){var z=this.props.externalLinkElement||this.props.theaterLinkElement;if(z)z.click()}return x(y)}.bind(this)}.bind(this)}.bind(this),v=function(x){__p&&__p();var y=x.getState;return function(z){__p&&__p();return function(A){__p&&__p();var B=y().base.showFallbackUI;if(!B){if(A.type===c("SphericalMediaActions").TURN_ON)this.$SphericalPhotoViewerInFeed12();if(A.type===c("SphericalMediaActions").SETUP_RENDERER||A.type===c("SphericalMediaActions").SHOW_FALLBACK){this.$SphericalPhotoViewerInFeed13();if(this.props.initialViewElement)c("CSS").hide(this.props.initialViewElement)}}return z(A)}.bind(this)}.bind(this)}.bind(this),w=function(x){__p&&__p();var y=x.getState;return function(z){__p&&__p();return function(A){__p&&__p();var B=y().base.showFallbackUI;if(!B)if(A.type===c("SphericalMediaActions").TURN_OFF){this.$SphericalPhotoViewerInFeed3=false;c("CSS").show(this.props.loadingElement);this.$SphericalPhotoViewerInFeed14();if(this.props.initialViewElement)c("CSS").show(this.props.initialViewElement)}return z(A)}.bind(this)}.bind(this)}.bind(this);return t.concat([u,v,w])};s.prototype.componentDidMount=function(){__p&&__p();this.__updateState();this.__store.dispatch(o(false));this.$SphericalPhotoViewerInFeed14();var t=c("onViewportChanged")(this.$SphericalPhotoViewerInFeed15);this.$SphericalPhotoViewerInFeed1=c("Arbiter").subscribe("PhotoSnowlift.CLOSE",function(){this.$SphericalPhotoViewerInFeed3=false;t.scheduleCheck()}.bind(this));this.$SphericalPhotoViewerInFeed2=c("Arbiter").subscribe("PhotoSnowlift.OPEN",function(){this.__store.dispatch(o(false));c("Bootloader").loadModules(["PhotoSnowlift"],function(w){this.$SphericalPhotoViewerInFeed7=w.getInstance()}.bind(this),"SphericalPhotoViewerInFeed.react")}.bind(this));this.$SphericalPhotoViewerInFeed3=false;var u=new(c("SubscriptionsHandler"))(),v=c("ReactDOM").findDOMNode(this);this.__store.dispatch(p(v));u.addSubscriptions(c("Event").listen(v,"mouseenter",this.$SphericalPhotoViewerInFeed16),c("Event").listen(v,"touchstart",this.$SphericalPhotoViewerInFeed16));t.scheduleCheck();this.$SphericalPhotoViewerInFeed4=t;this.$SphericalPhotoViewerInFeed6=u;this.$SphericalPhotoViewerInFeed5=v;this.$SphericalPhotoViewerInFeed9=50;this.$SphericalPhotoViewerInFeed10=0;this.$SphericalPhotoViewerInFeed17();c("onViewportChanged")(this.$SphericalPhotoViewerInFeed18)};s.prototype.UNSAFE_componentWillMount=function(){this.__updateState()};s.prototype.componentWillUnmount=function(){this.$SphericalPhotoViewerInFeed19();this.$SphericalPhotoViewerInFeed5=null;j.componentWillUnmount.call(this)};s.prototype.$SphericalPhotoViewerInFeed19=function(){__p&&__p();if(this.$SphericalPhotoViewerInFeed1){c("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed1);this.$SphericalPhotoViewerInFeed1=null}if(this.$SphericalPhotoViewerInFeed2){c("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed2);this.$SphericalPhotoViewerInFeed2=null}this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove();this.$SphericalPhotoViewerInFeed4=null;this.$SphericalPhotoViewerInFeed6&&this.$SphericalPhotoViewerInFeed6.release();this.$SphericalPhotoViewerInFeed6=null};s.prototype.$SphericalPhotoViewerInFeed12=function(){c("CSS").addClass(this.props.loadingElement,"_2dz7");c("CSS").removeClass(this.props.loadingElement,"_3s0i")};s.prototype.$SphericalPhotoViewerInFeed14=function(){c("CSS").removeClass(this.props.loadingElement,"_2dz7");c("CSS").addClass(this.props.loadingElement,"_3s0i")};s.prototype.$SphericalPhotoViewerInFeed13=function(){c("CSS").removeClass(this.props.loadingElement,"_2dz7");setTimeout(function(){c("CSS").hide(this.props.loadingElement)}.bind(this),300)};s.prototype.$SphericalPhotoViewerInFeed20=function(){return this.__store.getState().base.isRendererActive};s.prototype.$SphericalPhotoViewerInFeed21=function(t,u){if(this.$SphericalPhotoViewerInFeed3){if(!this.$SphericalPhotoViewerInFeed5)return;var v=c("getElementRect")(this.$SphericalPhotoViewerInFeed5),w=v.top+v.bottom/2;this.$SphericalPhotoViewerInFeed8=w/(t-u)*100;if(!this.$SphericalPhotoViewerInFeed11)this.$SphericalPhotoViewerInFeed17()}};s.prototype.$SphericalPhotoViewerInFeed17=function(){__p&&__p();if(this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.isOpen)return;if(this.$SphericalPhotoViewerInFeed8!==undefined){this.$SphericalPhotoViewerInFeed11=true;var t=this.__store.getState().base,u=t.viewStore,v=t.aspectRatio,w=t.partialLimits,x=u.getState().view,y=x.fov,z=x.centeredYaw;if(z!==this.$SphericalPhotoViewerInFeed10){this.$SphericalPhotoViewerInFeed9=this.$SphericalPhotoViewerInFeed8;this.$SphericalPhotoViewerInFeed10=z;this.$SphericalPhotoViewerInFeed11=false;return}requestAnimationFrame(function(){return this.$SphericalPhotoViewerInFeed17()}.bind(this));if(this.$SphericalPhotoViewerInFeed8<-100||this.$SphericalPhotoViewerInFeed8>200)this.$SphericalPhotoViewerInFeed9=50;var A=y*v/2,B=l(this.$SphericalPhotoViewerInFeed8,this.$SphericalPhotoViewerInFeed9,this.$SphericalPhotoViewerInFeed10,w.partialLeftDegrees,w.partialRightDegrees,A),C=B.yaw,D=B.success;if(D){var E=u.getState().view.yaw;if(C!==E)u.dispatch(k(C))}}};s.prototype.$SphericalPhotoViewerInFeed23=function(){this.$SphericalPhotoViewerInFeed14();setTimeout(function(){if(!this.$SphericalPhotoViewerInFeed3&&this.$SphericalPhotoViewerInFeed20())this.__store.dispatch(n())}.bind(this),q);this.__store.dispatch(o(false))};s.prototype.$SphericalPhotoViewerInFeed22=function(){this.$SphericalPhotoViewerInFeed16();this.__store.dispatch(o(true))};f.exports=s}),null);