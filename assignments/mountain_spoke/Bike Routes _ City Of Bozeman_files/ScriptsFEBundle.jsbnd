(function(window){window.visionLiveConfig={}; (function(config){ ; })(window.visionLiveConfig); })(window);(function(n,t){"use strict";var u,r,i;n.visionLiveConfig.flexibleComponent=n.visionLiveConfig.flexibleComponent||{serverURL:""};n.viCurrentModule&&n.viCurrentModule.requires.push("vi.fe.componentbuilder.widget");u=t.module("vi.fe.componentbuilder.widget",["blockUI","viAppVisionLiveFlexibleComponentFields","vi.frontend.list.module"]);r=t.extend({apiEndPoint:""},n.visionLiveConfig||{});r.apiEndPoint=n.visionLiveConfig.flexibleComponent.serverURL;i=r.apiEndPoint;r.apiEndPoint=i.lastIndexOf("/")==i.length-1?i.substring(0,i.length-1)+"/":i+"/";u.constant("builderConfig",r)})(window,angular),function(n,t){"use strict";var i=t.module("vi.fe.componentbuilder.widget");i.controller("flexComponentWidgetController",["viFrontendListService","flexComponentService","$scope","$http","fieldTypeManager","$filter",function(i,r,u,f,e){function o(n){var u=[],i,l;for(t.forEach(n.headers,function(n){n.fieldTypeID===29&&u.push({fieldMetaID:n.id,uniqueName:n.uniqueName})}),i=0;i<u.length;i++){var f=0,h=n.records.items,c=[],e=u[i],o=e.uniqueName,a=e.uniqueName+"_Setting",v=e.uniqueName+"_SettingObj";t.forEach(h,function(n){if(n[o]){c.push({id:n[o]});var t=JSON.parse(n[a]||"{}");n[v]=t;f==0&&(f=t.selectedSourceValue)}});l={lookupRecords:c,listMetaID:f,fieldUniqueName:o};r.getLookupValues(l).then(function(n){var i=n.data.fieldUniqueName,r=i+"_RefData";t.forEach(h,function(t){t[i]&&(t[r]=s(t[i],n.data.lookupRecords))})})}}function s(n,t){for(var i=0;i<t.length;i++)if(t[i].id==n)return t[i].data;return""}function h(n){if(n.meta.fieldTypeID==29){var t=n.meta.settingObj.selectedSourceValue,i=[{id:n.data.valueLookup}],u={lookupRecords:i,listMetaID:t};r.getLookupValues(u).then(function(t){t.data.lookupRecords&&t.data.lookupRecords.length!=0&&(n.data[n.meta.uniqueName+"_RefData"]=t.data.lookupRecords[0].data)})}}u.sysConfig={TemplateUrl:"",Thumbnail:{ShowImageLink:"",ShowThumbnailLink:"",ConvertToString:function(n,t){return n?t===!0?this.ShowThumbnailLink.replace("id=0","id="+n):this.ShowImageLink.replace("id=0","id="+n):""}},Phone:{PhoneAndFaxNumberFormatting:"",ConvertToString:function(n){return n==null?"":$.viFormatPhone(n,this.PhoneAndFaxNumberFormatting.replace(/9/g,"0"))}},DateTime:{TimeAMFormat:"",TimePMFormat:"",ConvertToString:function(t,i){if(!t)return"";var r=JSON.parse(i);return r&&r.datetimeUseDateOnly?kendo.toString(kendo.parseDate(t),n.visionApps.cms_core.DateFormat):kendo.toString(kendo.parseDate(t),n.visionApps.cms_core.DateFormat+" "+n.visionApps.cms_core.TimeFormat).replace(/am/ig,this.TimeAMFormat).replace(/pm/ig,this.TimePMFormat)}},DetailUrl:{DefaultLink:"",FlexComponentUrl:"",FlexListUrl:"",NavUrl:"",NavId:0,HrefLink:function(n){return this.DefaultLink.replace("ContentID",n)}},Email:{AsciiEncode:function(n){return n}},Website:{UseSplash:!1,ApplicationPath:"",MaskSplashText:function(n){if(!n)return"";var t=n.indexOf("http")==0,i=this.ApplicationPath+"?splash="+n+"&____isexternal=true";return this.UseSplash&&t?i:n}}};u.detail={};u.detailInit={init:function(n,f){var c=t.element("#flexible-ext-data-"+f).text(),o=JSON.parse(c),l=JSON.parse(t.element("#flexible-data-"+f).text()),s;t.merge(u.sysConfig,o);s={id:l.itemId,componentGuid:n.componentGuid,listUniqueName:n.listUniqueName,dataPromise:r.loadDetailInfo};u.detail=i.detail(s);u.detail.fieldTypeManager=e;u.detail.fieldTypeManager.init({fieldOptions:{relativeTemplatePath:o.TemplateUrl}});u.$watch(function(){return(u.detail.fields||[]).length},function(){t.forEach(u.detail.fields,function(n){n.type=e.getFieldType(n.meta.fieldTypeID);n.type.initFieldMeta(n);h(n)})})}};u.builder={};u.builderInit={init:function(n,f){var a=this,l=t.element("#flexible-ext-data-"+f).text(),s=JSON.parse(l),h,c;t.merge(u.sysConfig,s);h=JSON.parse(t.element("#flexible-data-"+f).text());c={listViewInfo:h,componentGuid:n.componentGuid,listUniqueName:n.listUniqueName,dataPromise:r.loadListInfo,getFilters:r.getFilters,getListDataSource:r.getListDataSource,getMultiDataSource:r.getMultiDataSource,setupData:function(n){var t=u.sysConfig.DetailUrl;t.DefaultLink=t.DefaultLink.replace(t.FlexComponentUrl,n.componentInfo.componentUrl);t.DefaultLink=t.DefaultLink.replace(t.FlexListUrl,n.componentInfo.listUrl);t.DefaultLink=t.DefaultLink.replace(t.NavUrl,t.NavId?t.NavId:"");u.sysConfig.DetailUrl=t;o(n)},fieldTypeManager:e};u.builder=i.builder(c);u.builder.fieldTypeManager||(u.builder.fieldTypeManager=e);u.builder.fieldTypeManager.init({fieldOptions:{relativeTemplatePath:s.TemplateUrl}})}}}])}(window,angular),function(n,t){"use strict";function i(n,t){function i(i){var r=t.apiEndPoint+"api/FeFlexComponent/GetDetail";return n({method:"POST",url:r,data:i})}function r(i){var r=t.apiEndPoint+"api/FeFlexComponent/GetFilters";return n({method:"POST",url:r,data:i})}function u(i){var r=t.apiEndPoint+"api/FeFlexComponent/getListDataSource";return n({method:"POST",url:r,data:i})}function f(i){var r=t.apiEndPoint+"api/FeFlexComponent/getMultiDataSource";return n({method:"POST",url:r,data:i})}function e(i){var r=t.apiEndPoint+"api/FeFlexComponent/Get";return n({method:"POST",url:r,data:i})}function o(i){var r=t.apiEndPoint+"api/FeFlexComponent/GetLookupData";return n({method:"POST",url:r,data:i})}return{loadDetailInfo:i,loadListInfo:e,getLookupValues:o,getFilters:r,getListDataSource:u,getMultiDataSource:f}}var r=t.module("vi.fe.componentbuilder.widget");r.factory("flexComponentService",i);i.$inject=["$http","builderConfig"]}(window,angular),function(n,t){var i=t.module("viAppVisionLiveFlexibleComponentFields",[]);i.constant("builderConfig",{apiEndPoint:"",cms6Endpoint:""});i.config(["builderConfig",function(t){t.apiEndPoint=n.visionLiveConfig.flexibleComponent.serverURL}])}(window,angular),function(n,t){"use strict";var i=t.module("viAppVisionLiveFlexibleComponentFields");i.directive("componentLookupItem",["$compile",function(n){return{restrict:"AE",replace:!1,scope:{format:"=lookupFormat",m:"=lookupRecord"},link:function(t,i){t.$watch(function(){return t.format},function(){t&&t.m&&(i.html(t.format),n(i.contents())(t))})}}}])}(window,window.angular),function(n,t){function u(){}function f(){this._items={};this._baseType=u;this._options={fieldOptions:{}};this._fieldTypes=[];this.fieldTypeDataList=FIELDTYPEDATALIST}function i(n){return t.isUndefined(n)||n===""||n===null||n!==n||typeof n==undefined}function r(n){var i="^",r="$",t=n;return n.indexOf(i)!=0&&(t=i+t),n.indexOf(r)!=n.length-1&&(t=t+r),t}var e=t.module("viAppVisionLiveFlexibleComponentFields");FIELDVALUETYPES={NUMBER:1,STRING:2,HTML:3,DATETIME:4,TIME:5,FLOAT:6,BIT:7,LOOKUP:8};FIELDTYPEDATALIST=[{id:1,name:"SingleLineText",displayName:"Single Line Text",css:"single-line-icon",order:1,advanced:!1,sortable:!0,listShown:!0},{id:2,name:"ParagraphText",displayName:"Paragraph Text",css:"paragraph-icon",order:2,advanced:!1,sortable:!0,listShown:!0},{id:3,name:"SingleDropdown",displayName:"Single Dropdown",css:"single-dropdown-icon",order:3,advanced:!1,sortable:!0,listShown:!0},{id:5,name:"Number",displayName:"Number",css:"number-icon",order:5,advanced:!1,sortable:!0,listShown:!0},{id:8,name:"RichHtml",displayName:"Rich-text Editor (HTML)",css:"editor-icon",order:8,advanced:!1,sortable:!0,listShown:!1},{id:21,name:"DateTime",displayName:"Date/Time",css:"date-time-icon",order:21,advanced:!0,sortable:!0,listShown:!0},{id:23,name:"Phone",displayName:"Phone",css:"phone-icon",order:23,advanced:!0,sortable:!0,listShown:!0},{id:25,name:"Website",displayName:"Website",css:"website-icon",order:25,advanced:!0,sortable:!0,listShown:!0},{id:26,name:"Email",displayName:"Email",css:"email-icon",order:26,advanced:!0,sortable:!0,listShown:!0},{id:27,name:"Thumbnail",displayName:"Thumbnail",css:"thumbnail-icon",order:27,advanced:!0,sortable:!1,listShown:!0},{id:29,name:"Lookup",displayName:"Lookup",order:29,advanced:!0,sortable:!1,listShown:!0},];PATTERNS={numberPattern:"[0-9]+",uniqueNamePattern:"[a-zA-Z][a-zA-Z0-9_]*",emailPattern:"([\\w\\-\\.]+)@(([[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w\\-]+\\.)+))([a-zA-Z]{1,4}|[0-9]{1,3})(]?)",urlPattern:"(((http|ftp|https)://)?[\\w-]+(\\.[\\w-]+)+([\\w.,@?^=%&amp;:\\/~+#-]*[\\w@?^=%&amp;\\/~+#-])?)|((\\/?[\\w-]+)(\\/[\\w-]+)*\\/?)",internalUrlPattern:"(\\/?[\\w-]+)(\\/[\\w-?&=]+)*\\/?",cssClassNamePattern:"([a-zA-Z0-9\\-_]+)( [a-zA-Z0-9\\-_]+)?",phonePattern:"(\\d{3})(\\d{3})(\\d{4})"};u.prototype={_seed:new Date,_name:"fieldTypeBase",_options:{relativeTemplatePath:""},uniqueNameValidator:"fieldSettingUniqueName, fieldSettingUniqueNameAllow",_getSrc:function(n){return this._options.relativeTemplatePath+n+this._name+".tpl?t="+this._seed.getMilliseconds()},init:function(n){this._seed=new Date;t.extend(this,PATTERNS);t.extend(this._options,n||{})},_mergeDefaultFieldMeta:function(n){var i=t.extend({allowSearch:!1,allowDuplicate:!0,valueType:FIELDVALUETYPES.STRING},n);return this._redefineProperties(i),i},_makeNameUnique:function(n){typeof n.id!="undefined"&&n.id||(n.uniqueName=(n._label||"").replace(/[^0-9a-z_]+/ig,""))},_redefineProperties:function(n){var t=this;Object.defineProperty(n,"checkForDuplicates",{get:function(){return!this.allowDuplicate},set:function(n){this.allowDuplicate=!n}});n._label=n.label;t._makeNameUnique(n);Object.defineProperty(n,"label",{get:function(){return this._label},set:function(n){this._label=n;t._makeNameUnique(this)}})},createFieldMeta:function(){return{}},initFieldMeta:function(n){var i=this.createFieldMeta();n.meta.setting&&(i.settingObj=t.fromJson(n.meta.setting));n.meta=t.extend(i,n.meta);n.meta.errorMessages={flexComponentFieldDuplicate:"This field value already exists."};n.meta.requiredErrorMessage&&(n.meta.errorMessages.required=n.meta.requiredErrorMessage);this.initAdditionalErrorMesssages(n)},saveFieldMeta:function(n){n.meta.settingObj!=undefined&&(n.meta.setting=t.toJson(n.meta.settingObj))},initFieldData:function(n,i){var r=!i||i.id<=0;n.data=n.data||{fieldMetaID:n.meta.id};r&&(n.data.valueNumber||(n.data.valueNumber=n.meta.defaultValueNumber),n.data.valueString||(n.data.valueString=n.meta.defaultValueString),n.data.valueHTML||(n.data.valueHTML=n.meta.defaultValueHTML),n.data.valueFloat||(n.data.valueFloat=n.meta.defaultValueFloat),n.data.valueDatetime||(n.data.valueDatetime=n.meta.defaultValueDatetime),n.data.valueTime||(n.data.valueTime=n.meta.defaultValueTime),n.data.valueBit||(n.data.valueBit=n.meta.defaultValueBit));t.forEach(n.meta.children,function(n){n.data=n.data||{fieldMetaID:n.meta.id};r&&(n.data.valueNumber||(n.data.valueNumber=n.meta.defaultValueNumber),n.data.valueString||(n.data.valueString=n.meta.defaultValueString),n.data.valueHTML||(n.data.valueHTML=n.meta.defaultValueHTML),n.data.valueFloat||(n.data.valueFloat=n.meta.defaultValueFloat),n.data.valueDatetime||(n.data.valueDatetime=n.meta.defaultValueDatetime),n.data.valueTime||(n.data.valueTime=n.meta.defaultValueTime),n.data.valueBit||(n.data.valueBit=n.meta.defaultValueBit))});this.initAdditionalFieldData(n,r)},initAdditionalFieldData:function(){},initAdditionalErrorMesssages:function(){},formatGridData:function(n){return{value:n!=null?n.toString():n,isHtml:!1,formatStr:null}},getBuilderSettingSrc:function(){return this._getSrc("FieldBuSetting/")},getBuilderDisplaySrc:function(){return this._getSrc("FieldBuDisplay/")},getBackendEditSrc:function(){return this._getSrc("FieldBeEdit/")},getBackendDisplaySrc:function(){return this._getSrc("FieldBeDisplay/")},getFrontendDisplaySrc:function(){return this._getSrc("FieldFeDisplay/")},getFrontendListDisplaySrc:function(){return this._getSrc("FieldFeLiDisplay/")},validateField:function(n,t){return this.validateFieldBase(n,t)},validateFieldBase:function(n,t){var r=!0,u="";return t.isRequired&&i(n)&&(r=!1,u+=t.requiredErrorMessage?t.requiredErrorMessage:t.uniqueName+" is required."),{valid:r,message:u}}};f.prototype={_defineClass:function(n,i,r){i&&t.extend(n.prototype,i.prototype);r&&t.extend(n.prototype,r)},init:function(n){var i=this;t.extend(i._options,n||{});t.forEach(i._items,function(n,t){var r=new n;r.init(i._options.fieldOptions);i._fieldTypes[t]=r})},defineFieldType:function(n,t,i){var f=this._baseType,r,u;return t&&this._items[t]!=undefined&&(f=this._items[t]),r=function(){},this._defineClass(r,f,i),u=Enumerable.From(FIELDTYPEDATALIST).Where('$.name=="'+n+'"').FirstOrDefault(),r.prototype._name=n,r.prototype.className=n.toLocaleLowerCase(),r.prototype.data=u,r.prototype.sortable=u?u.sortable:!0,this._items[n]=r,r},getFieldTypes:function(){return this._fieldTypes},getFieldType:function(n){var t=Enumerable.From(FIELDTYPEDATALIST).Where("$.id == "+n).Select("$.name").FirstOrDefault();return this._fieldTypes[t]}};e.factory("fieldTypeManager",["$http","jsonDataUtil",function(u,e){var o=new f;return e.init(),o.defineFieldType("SingleLineText",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,label:"Single Line Text",listIsSortable:!0,settingObj:{rangeMin:0,rangeMax:70,rangeErrorMessage:null,regex:null,regexErrorMessage:null}})},initAdditionalErrorMesssages:function(n){n.meta.settingObj.rangeErrorMessage&&(n.meta.errorMessages.minlength=n.meta.settingObj.rangeErrorMessage,n.meta.errorMessages.maxlength=n.meta.settingObj.rangeErrorMessage);n.meta.settingObj.regexErrorMessage&&(n.meta.errorMessages.pattern=n.meta.settingObj.regexErrorMessage)},validateField:function(n,t){var f=this.validateFieldBase(n,t),u;return i(n)||t.setting&&(u=JSON.parse(t.setting),u.rangeMin>0&&n.length<u.rangeMin&&(f.valid=!1,f.message+=u.rangeErrorMessage?u.rangeErrorMessage:t.uniqueName+" should not be less than "+u.rangeMin+" character(s).",f.message+="\n"),n.length>u.rangeMax&&(f.valid=!1,f.message+=u.rangeErrorMessage?u.rangeErrorMessage:t.uniqueName+" should not be more than "+u.rangeMax+" characters.",f.message+="\n"),u.regex&&(f.valid=n.match(r(u.regex)),f.valid||(f.message+=u.regexErrorMessage?u.regexErrorMessage:"Invalid "+t.uniqueName+".",f.message+="\n"))),f}}),o.defineFieldType("Number",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.NUMBER,label:"Number",listIsSortable:!0,settingObj:{rangeMin:0,rangeMax:50,rangeErrorMessage:null}})},initAdditionalErrorMesssages:function(n){n.meta.settingObj.rangeErrorMessage&&(n.meta.errorMessages.min=n.meta.settingObj.rangeErrorMessage,n.meta.errorMessages.max=n.meta.settingObj.rangeErrorMessage);n.meta.errorMessages.pattern="This field is a number."},validateField:function(n,t){var u=this.validateFieldBase(n,t),e,f;return i(n)||(e=parseInt(n),(isNaN(e)||!n.match(/^\d+$/))&&(u.valid=!1,u.message+="Invalid "+t.uniqueName,u.message+="\n"),e&&t.setting&&(f=JSON.parse(t.setting),(e<f.rangeMin||e>f.rangeMax)&&(u.valid=!1,u.message+=f.rangeErrorMessage?f.rangeErrorMessage:t.uniqueName+" should be between "+f.rangeMin+" and "+f.rangeMax+".",u.message+="\n"),f.regex&&(u.valid=e.match(r(f.regex)),u.valid||(u.message+=f.regexErrorMessage?f.regexErrorMessage:"Invalid "+t.uniqueName+" format.",u.message+="\n")))),u}}),o.defineFieldType("SingleDropdown",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,label:"Single Dropdown",maxID:0,includeInBeList:!1,listIsSortable:!0,settingObj:{selectedValue:"",sourceTypeID:"0",customSource:[{value:"Option 1",text:"Option 1"},{value:"Option 2",text:"Option 2"},{value:"Option 3",text:"Option 3"}]},_sourceTypes:[{id:"0",name:"Custom"},{id:"1",name:"U.S.States"},{id:"2",name:"Canadian Provinces"}],_dataSource:e.states,indexes:[],initDatasource:function(){var n=0,t;this.maxID=0;for(t in this.settingObj.customSource)this.indexes[n++]=this.maxID++},addItem:function(n,i){var r=t.element(n.target).scope(),u;r&&r.scrollSticky&&r.scrollSticky();u={value:" ",text:""};this.settingObj.customSource.splice(i+1,0,u);this.indexes.splice(i+1,0,this.maxID++)},removeItem:function(n){this.settingObj.customSource.splice(n,1);this.indexes.splice(n,1)},sort:function(n,t){var i=n,r=t.next!=undefined?i>t.next?t.next:t.next-1:this.settingObj.customSource.length-1;this.settingObj.customSource.splice(r,0,this.settingObj.customSource.splice(i,1)[0])}})},initAdditionalFieldData:function(n,t){t&&!n.data.valueString&&n.meta.settingObj&&n.meta.settingObj.selectedValue&&(n.data.valueString=n.meta.settingObj.selectedValue)},validateField:function(n,t){var u=this.validateFieldBase(n,t),f,r;if(!i(n)){f=JSON.parse(t.setting);r=null;switch(f.sourceTypeID){case"0":r=Enumerable.From(f.customSource).Where("$.value.toLocaleLowerCase() == '"+n.toLocaleLowerCase()+"'").FirstOrDefault();r&&(u.value=r.value);break;case"1":r=Enumerable.From(e.states).Where("$.Country == 'US' && $.Abbreviation == '"+n.toLocaleUpperCase()+"'").FirstOrDefault();r&&(u.value=r.Abbreviation);break;case"2":r=Enumerable.From(e.states).Where("$.Country == 'CA' && $.Abbreviation == '"+n.toLocaleUpperCase()+"'").FirstOrDefault();r&&(u.value=r.Abbreviation)}r||(u.valid=!1,u.message+="Invalid "+t.uniqueName+".\n")}return u}}),o.defineFieldType("Address",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,label:"Address"})}}),o.defineFieldType("FullName",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,label:"Full Name"})}}),o.defineFieldType("Website",null,{createFieldMeta:function(){var n=this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,label:"Website",listIsSortable:!0,settingObj:{allowExternal:!1,allowExternalErrorMessage:null},children:{Text:{valueType:FIELDVALUETYPES.STRING,label:"Text",display:!1,fieldTypeId:1},Link:{valueType:FIELDVALUETYPES.STRING,label:"Link",display:!0,fieldTypeId:25}}});return Object.defineProperty(n,"urlpattern",{get:function(){return this.settingObj&&this.settingObj.allowExternal==!0?PATTERNS.urlPattern:PATTERNS.internalUrlPattern},set:function(){}}),n},initAdditionalErrorMesssages:function(n){n.meta.settingObj&&n.meta.settingObj.allowExternalErrorMessage&&(n.meta.errorMessages.pattern=n.meta.settingObj.allowExternalErrorMessage)},validateField:function(t,r){var e="Invalid "+r.uniqueName+" format.\n",u=this.validateFieldBase(t,r),f;return i(t)||(f=JSON.parse(r.setting),f.allowExternal?(u.valid=$.isUrl(t)||$.isIntranetUrl(n.visionOptions.virtualApplicationPath+t),u.valid||(u.message+=e)):(u.valid=$.isIntranetUrl(n.visionOptions.virtualApplicationPath+t),u.valid?$.isUrl(t)&&(u.valid=!1,u.message+=f.allowExternalErrorMessage?f.allowExternalErrorMessage:e):u.message+=e)),u},formatGridData:function(n,t,i,r){var u=Object.keys(r).length!==0?r.Text.display&&i[r.Text.field]?i[r.Text.field]:i[r.Link.field]:n,f=Object.keys(r).length!==0?i[r.Link.field]:n;return{value:f?u?"<a class='ellipsis' title='"+u+"' href='"+f+"' target='_blank'>"+$("<div/>").text(u).html()+"<\/a>":"":"<span class='ellipsis' title='"+u+"'>"+u+"<\/span>",isHtml:!0}}}),o.defineFieldType("RichHtml",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.HTML,listIsSortable:!1,label:"Rich-text Editor"})}}),o.defineFieldType("DateTime",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.DATETIME,label:"Date and Time",listIsSortable:!0,settingObj:{datetimeRangeMin:null,datetimeRangeMax:null,datetimeRangeErrorMessage:null,datetimeUseDateOnly:!1},minDateTimeFrom:function(){return"1/1/1800 12:00 AM"},maxDateTimeTo:function(){return"12/31/2099 12:00 AM"},minDateTime:function(){return this.settingObj.datetimeRangeMin||"1/1/1800 12:00 AM"},maxDateTime:function(){return this.settingObj.datetimeRangeMax||"12/31/2099 12:00 AM"}})},initAdditionalErrorMesssages:function(n){n.meta.settingObj&&n.meta.settingObj.datetimeRangeErrorMessage&&(n.meta.errorMessages.datetimerange=n.meta.settingObj.datetimeRangeErrorMessage);n.meta.requiredErrorMessage&&(n.meta.errorMessages.required=n.meta.requiredErrorMessage)},formatGridData:function(n,t){var r=t.currentSettingExt&&t.currentSettingExt.datetimeUseDateOnly?t.ShortDateFormatString:t.ShortDateFormatString+" "+t.ShortTimeFormatStringWithoutSecond,i=n?kendo.toString(kendo.parseDate(n),r):null;return i&&t.TimeAMFormat&&(i=i.replace(/am/ig,t.TimeAMFormat).replace(/pm/ig,t.TimePMFormat)),{value:i,isHtml:!1,formatStr:r}},validateField:function(n,t){var r=this.validateFieldBase(n,t),f,u;if(!i(n))try{f=Date.parse(n);isNaN(f)?(r.valid=!1,r.valid||(r.message+="Invalid "+t.uniqueName+".\n")):f&&t.setting&&(u=JSON.parse(t.setting),(f>Date.parse(u.datetimeRangeMax)||f<Date.parse(u.datetimeRangeMin))&&(r.valid=!1,r.message+=u.datetimeRangeErrorMessage?u.datetimeRangeErrorMessage:t.uniqueName+" should be between "+u.datetimeRangeMin+" and "+kendo.toString(kendo.parseDate(u.datetimeRangeMax),"MM/dd/yyyy hh:mm tt"),r.message+="\n"))}catch(e){r.valid=!1;r.valid||(r.message+="Invalid "+t.uniqueName+".\n")}return r}}),o.defineFieldType("ParagraphText",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,label:"Paragraph Text",listIsSortable:!0,settingObj:{rangeMin:0,rangeMax:500,rangeErrorMessage:null,regex:null,regexErrorMessage:null}})},initAdditionalErrorMesssages:function(n){n.meta.settingObj.rangeErrorMessage&&(n.meta.errorMessages.minlength=n.meta.settingObj.rangeErrorMessage,n.meta.errorMessages.maxlength=n.meta.settingObj.rangeErrorMessage);n.meta.settingObj.regexErrorMessage&&(n.meta.errorMessages.pattern=n.meta.settingObj.regexErrorMessage)},validateField:function(n,t){var f=this.validateFieldBase(n,t),u;return i(n)||t.setting&&(u=JSON.parse(t.setting),u.rangeMin>0&&n.length<u.rangeMin&&(f.valid=!1,f.message+=u.rangeErrorMessage?u.rangeErrorMessage:t.uniqueName+" should not be less than "+u.rangeMin+" character(s).",f.message+="\n"),n.length>u.rangeMax&&(f.valid=!1,f.message+=u.rangeErrorMessage?u.rangeErrorMessage:t.uniqueName+" should not be more than "+u.rangeMax+" characters.",f.message+="\n"),u.regex&&(f.valid=n.match(r(u.regex)),f.valid||(f.message+=u.regexErrorMessage?u.regexErrorMessage:"Invalid "+t.uniqueName+".",f.message+="\n"))),f}}),o.defineFieldType("Email",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,listIsSortable:!0,label:"Email"})},validateField:function(n,t){var r=this.validateFieldBase(n,t);return i(n)||(r.valid=n.match(this.emailPattern),r.valid||(r.message+="Invalid "+t.uniqueName+".\n")),r}}),o.defineFieldType("Phone",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.STRING,listIsSortable:!0,label:"Phone",format:n.visionApps.cms_core.PhoneFormat})},formatGridData:function(n,t){return{value:$.viFormatPhone(n,t.PhoneFormatString),isHtml:!1,formatStr:t.PhoneFormatString}},validateField:function(n,t){var r=this.validateFieldBase(n,t);return i(n)||(r.valid=n.match(this.phonePattern)&&n.length==10,r.valid||(r.message+="Invalid "+t.uniqueName+".\n")),r}}),o.defineFieldType("Thumbnail",null,{createFieldMeta:function(){return this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.NUMBER,listIsSortable:!1,label:"Thumbnail"})},formatGridData:function(n,t){return{value:'<img src="'+t.imgBaseUrl+"?id="+n+'" alt=""/>',isHtml:!0}}}),o.defineFieldType("Lookup",null,{createFieldMeta:function(){var n=this._options.apiEndPoint,r=this._options.currentComponentID,i=this._mergeDefaultFieldMeta({valueType:FIELDVALUETYPES.LOOKUP,listIsSortable:!1,label:"Component Source",settingObj:{displayFormat:"",selectedSourceValue:""},applyComponentSource:function(){var i=this;n&&u({method:"POST",data:{currentNonPublishedComponentID:r},url:n+"admin/api/component/builderGetComponentSource"}).then(function(n){i._componentSource.splice(0,i._componentSource.length);t.forEach(n.data,function(n){i._componentSource.push({text:n.name,value:""+n.listMetaID,fieldNames:n.fieldNames,singleLineTextFieldName:n.singleLineTextFieldName})})})},applyDataSource:function(){var i=this;n&&u({method:"POST",data:{listMetaID:this.settingObj.selectedSourceValue},url:n+"api/feFlexComponent/getListDataSource"}).then(function(n){i._dataSource.splice(0,i._dataSource.length);t.forEach(n.data,function(n){i._dataSource.push(n)})})},changeComponentSource:function(){var i=this,t=null,n,r;if(this.settingObj.selectedSourceValue)for(n=0,r=i._componentSource.length;n<r;n++)if(i._componentSource[n].value==this.settingObj.selectedSourceValue){t=i._componentSource[n];break}t&&t.length!=0?(this.settingObj.displayFormat="{{m."+t.singleLineTextFieldName+"}}",this.applyDataSource()):(this.settingObj.displayFormat="",this._dataSource.splice(0,this._dataSource.length))},_componentSource:[],_dataSource:[]});return i.applyComponentSource(),i},initAdditionalErrorMesssages:function(n){n.meta.applyDataSource()}}),o}])}(window,angular),function(n,t){var i=t.module("viAppVisionLiveFlexibleComponentFields");i.factory("jsonDataUtil",["$http","$q",function(t){function r(){u()}function u(){t({method:"GET",url:n.visionOptions.cmsAdminEndPoint+"Components/Scripts/app/jsondata/states.json"}).then(function(n){i.states=n.data})}var i={init:r,states:[]};return i}])}(window,angular);;
